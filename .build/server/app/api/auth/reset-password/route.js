"use strict";(()=>{var e={};e.id=9436,e.ids=[9436],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},81928:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{POST:()=>d});var s=r(79182),a=r(72007),i=r(56719),o=r(93442),u=r(83178),c=r(3390),l=r.n(c);async function d(e){try{let{email:t,code:r,newPassword:n}=await e.json();if(!t||!r||!n)return o.NextResponse.json({error:"T\xfcm alanlar gerekli"},{status:400});if(n.length<8)return o.NextResponse.json({error:"Şifre en az 8 karakter olmalıdır"},{status:400});let s=await u.default.user.findUnique({where:{email:t.toLowerCase().trim()}});if(!s)return o.NextResponse.json({error:"Ge\xe7ersiz kod veya email"},{status:400});if(s.verificationCode!==r)return o.NextResponse.json({error:"Ge\xe7ersiz doğrulama kodu"},{status:400});if(!s.verificationCodeExpiry||new Date>new Date(s.verificationCodeExpiry))return o.NextResponse.json({error:"Doğrulama kodunun s\xfcresi dolmuş. L\xfctfen yeni kod isteyin."},{status:400});let a=await l().hash(n,10);return await u.default.user.update({where:{id:s.id},data:{password:a,verificationCode:null,verificationCodeExpiry:null}}),o.NextResponse.json({success:!0,message:"Şifreniz başarıyla g\xfcncellendi. Şimdi giriş yapabilirsiniz."})}catch(e){return console.error("Şifre g\xfcncelleme hatası:",e),o.NextResponse.json({error:"Bir hata oluştu"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/reset-password/route",pathname:"/api/auth/reset-password",filename:"route",bundlePath:"app/api/auth/reset-password/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/auth/reset-password/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=p,w="/api/auth/reset-password/route";function y(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},83178:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var n=r(53524);let s=globalThis,a="phase-production-build"===process.env.NEXT_PHASE||!0,i=s.prisma??(()=>{let e=new n.PrismaClient({log:["error"],datasources:{db:{url:function(){let e=process.env.DATABASE_URL||"";if(e.includes("connection_limit")||e.includes("pool_timeout"))return e;let t=e.includes("?")?"&":"?";return`${e}${t}connection_limit=${a?1:5}&pool_timeout=${a?60:10}&connect_timeout=5&socket_timeout=10&pgbouncer=true&statement_cache_size=0`}()}}});return e.$use(async(t,r)=>{let n=0;for(;n<=5;)try{let e=await r(t);return s.lastConnectTime=Date.now(),e}catch(r){let t=r instanceof Error?r.message:String(r);if((t.includes("idle-session timeout")||t.includes("terminating connection")||t.includes("ECONNRESET")||t.includes("Connection refused")||t.includes("connection closed")||t.includes("socket")||t.includes("ETIMEDOUT")||t.includes("connection timed out")||t.includes("prepared statement"))&&n<5){if(n++,console.log(`[Prisma] Connection error, retry ${n}/5: ${t.substring(0,100)}`),n>=2)try{await e.$disconnect(),await e.$connect(),console.log("[Prisma] Reconnected successfully")}catch{}await new Promise(e=>setTimeout(e,100*Math.pow(2,n-1)));continue}throw r}}),e})();s.prisma=i,"undefined"!=typeof process&&process.on("beforeExit",async()=>{await i.$disconnect()});let o=null;"undefined"==typeof process||a||!o&&(a||(o=setInterval(async()=>{try{await i.$queryRaw`SELECT 1`}catch(e){console.warn("[Prisma KeepAlive] Bağlantı hatası, yeniden bağlanılıyor:",e.message?.substring(0,80));try{await i.$connect(),console.log("[Prisma KeepAlive] Yeniden bağlantı başarılı")}catch(e){console.error("[Prisma KeepAlive] Yeniden bağlantı başarısız!")}}},6e4)).unref());let u=i}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8412,7609,3390],()=>r(81928));module.exports=n})();