"use strict";(()=>{var e={};e.id=9118,e.ids=[9118],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},88855:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>c,patchFetch:()=>g,requestAsyncStorage:()=>w,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var i={};t.r(i),t.d(i,{POST:()=>u});var r=t(79182),s=t(72007),n=t(56719),o=t(93442),d=t(83178),l=t(85698);async function u(e){try{let a=e.headers.get("x-forwarded-for")?.split(",")[0]?.trim()||e.headers.get("x-real-ip")||"unknown";if(!(await (0,l.Dn)(a,"api/signup")).allowed)return o.NextResponse.json({error:"\xc7ok fazla deneme. L\xfctfen 1 saat sonra tekrar deneyin."},{status:429});let{email:t}=await e.json();if(!t)return o.NextResponse.json({error:"Email gerekli"},{status:400});let i=await d.default.user.findUnique({where:{email:t.toLowerCase().trim()}});if(!i)return o.NextResponse.json({success:!0,message:"EÄŸer bu email ile kayÄ±tlÄ± bir hesap varsa, ÅŸifre sÄ±fÄ±rlama kodu g\xf6nderildi"});let r=Math.floor(1e5+9e5*Math.random()).toString(),s=new Date(Date.now()+9e5);await d.default.user.update({where:{id:i.id},data:{verificationCode:r,verificationCodeExpiry:s}});try{let e=process.env.NEXTAUTH_URL||"https://takas-a.com",a=`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; background: #ffffff;">
          <div style="background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); padding: 30px; text-align: center;">
            <h1 style="color: white; margin: 0; font-size: 28px;">ğŸ” Åifre SÄ±fÄ±rlama</h1>
          </div>
          <div style="padding: 30px;">
            <p style="color: #333; font-size: 16px;">Merhaba <strong>${i.name||"KullanÄ±cÄ±"}</strong>,</p>
            <p style="color: #666; font-size: 14px;">Åifrenizi sÄ±fÄ±rlamak i\xe7in aÅŸaÄŸÄ±daki kodu kullanÄ±n:</p>
            <div style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); padding: 25px; text-align: center; border-radius: 12px; margin: 25px 0; border: 2px dashed #a855f7;">
              <h1 style="color: #7c3aed; font-size: 42px; letter-spacing: 8px; margin: 0; font-family: 'Courier New', monospace;">${r}</h1>
            </div>
            <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px 16px; margin: 20px 0; border-radius: 4px;">
              <p style="color: #92400e; margin: 0; font-size: 13px;">â±ï¸ Bu kod <strong>15 dakika</strong> ge\xe7erlidir.</p>
            </div>
            <p style="color: #666; font-size: 13px;">EÄŸer bu talebi siz yapmadÄ±ysanÄ±z, bu emaili g\xf6rmezden gelebilirsiniz. HesabÄ±nÄ±z g\xfcvende.</p>
          </div>
          <div style="background: #f9fafb; padding: 20px; text-align: center; border-top: 1px solid #e5e7eb;">
            <p style="color: #9ca3af; font-size: 12px; margin: 0;">TAKAS-A - G\xfcvenli Takas Platformu</p>
            <p style="color: #9ca3af; font-size: 11px; margin: 5px 0 0 0;">${e}</p>
          </div>
        </div>
      `,t=await fetch("https://apps.abacus.ai/api/sendNotificationEmail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deployment_token:process.env.ABACUSAI_API_KEY,subject:`ğŸ” TAKAS-A Åifre SÄ±fÄ±rlama Kodu: ${r}`,body:a,is_html:!0,recipient_email:i.email,sender_email:"noreply@takas-a.com",sender_alias:"TAKAS-A"})}),s=await t.json();console.log("Email g\xf6nderim sonucu:",s),s.success||console.error("Email g\xf6nderme baÅŸarÄ±sÄ±z:",s)}catch(e){console.error("Email g\xf6nderme hatasÄ±:",e)}return o.NextResponse.json({success:!0,message:"Åifre sÄ±fÄ±rlama kodu email adresinize g\xf6nderildi"})}catch(e){return console.error("Åifre sÄ±fÄ±rlama hatasÄ±:",e),o.NextResponse.json({error:"Bir hata oluÅŸtu"},{status:500})}}let p=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/forgot-password/route",pathname:"/api/auth/forgot-password",filename:"route",bundlePath:"app/api/auth/forgot-password/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/auth/forgot-password/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:w,staticGenerationAsyncStorage:m,serverHooks:f}=p,c="/api/auth/forgot-password/route";function g(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},85698:(e,a,t)=>{t.d(a,{Dn:()=>n,s$:()=>o});var i=t(83178),r=t(59521);let s={"api/products":{windowMs:6e4,maxRequests:100},"api/favorites":{windowMs:6e4,maxRequests:60},"api/messages":{windowMs:6e4,maxRequests:30},"api/signup":{windowMs:36e5,maxRequests:5},"api/swap-requests":{windowMs:6e4,maxRequests:20},"api/services":{windowMs:6e4,maxRequests:30},"api/wishboard":{windowMs:6e4,maxRequests:20},"api/profile/photo":{windowMs:3e5,maxRequests:10},"api/admin/backup":{windowMs:36e5,maxRequests:3},"api/auth/two-factor":{windowMs:3e5,maxRequests:5},"api/valor/calculate":{windowMs:6e4,maxRequests:5},"api/ai-visualize":{windowMs:6e4,maxRequests:5},"api/visual-search":{windowMs:6e4,maxRequests:5},"api/ai-moderation":{windowMs:6e4,maxRequests:10},"api/ai-translate":{windowMs:6e4,maxRequests:10},default:{windowMs:6e4,maxRequests:100}};async function n(e,a){if(["join@takas-a.com"].includes(e))return{allowed:!0,remaining:999,resetAt:new Date(Date.now()+6e4)};let t=s[a]||s.default,r=new Date,n=new Date(r.getTime()-t.windowMs);try{let s=await i.default.rateLimit.findUnique({where:{identifier_endpoint:{identifier:e,endpoint:a}}});if(!s)return await i.default.rateLimit.create({data:{identifier:e,endpoint:a,count:1,windowStart:r}}),{allowed:!0,remaining:t.maxRequests-1,resetAt:new Date(r.getTime()+t.windowMs)};if(s.windowStart<n)return await i.default.rateLimit.update({where:{id:s.id},data:{count:1,windowStart:r}}),{allowed:!0,remaining:t.maxRequests-1,resetAt:new Date(r.getTime()+t.windowMs)};if(s.count>=t.maxRequests){let e=new Date(s.windowStart.getTime()+t.windowMs);return{allowed:!1,remaining:0,resetAt:e}}return await i.default.rateLimit.update({where:{id:s.id},data:{count:s.count+1}}),{allowed:!0,remaining:t.maxRequests-s.count-1,resetAt:new Date(s.windowStart.getTime()+t.windowMs)}}catch(e){return console.error("Rate limit check error:",e),{allowed:!1,remaining:0,resetAt:new Date(r.getTime()+t.windowMs)}}}function o(e){return(0,r.H9)(e)}}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),i=a.X(0,[8412,7609,9521],()=>t(88855));module.exports=i})();