"use strict";(()=>{var e={};e.id=3898,e.ids=[3898],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},462:(e,a,r)=>{r.r(a),r.d(a,{originalPathname:()=>w,patchFetch:()=>E,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>b,staticGenerationAsyncStorage:()=>h});var t={};r.r(t),r.d(t,{DELETE:()=>m,GET:()=>k,PATCH:()=>y,dynamic:()=>p});var i=r(79182),s=r(72007),n=r(56719),o=r(93442),l=r(57978),u=r(11826),d=r(83178),c=r(23522);let p="force-dynamic";async function m(e,{params:a}){try{let e=await (0,l.getServerSession)(u.L);if(!e?.user?.email)return o.NextResponse.json({error:"Giriş yapmanız gerekiyor"},{status:401});let r=await d.default.user.findUnique({where:{email:e.user.email}});if(!r)return o.NextResponse.json({error:"Kullanıcı bulunamadı"},{status:404});let t=await d.default.product.findUnique({where:{id:a.id}});if(!t)return o.NextResponse.json({error:"\xdcr\xfcn bulunamadı"},{status:404});let i="admin"===r.role;if(t.userId!==r.id&&!i)return o.NextResponse.json({error:"Bu işlem i\xe7in yetkiniz yok"},{status:403});return await d.default.product.update({where:{id:a.id},data:{deletedAt:new Date,deletedReason:i?"admin_deleted":"user_deleted",status:"deleted"}}),console.log(`[SOFT DELETE] \xdcr\xfcn soft delete edildi: ${t.id} - ${t.title} by ${r.email}`),o.NextResponse.json({success:!0,message:"\xdcr\xfcn başarıyla silindi. 30 g\xfcn i\xe7inde geri y\xfckleyebilirsiniz."})}catch(e){return console.error("Product delete error:",e),o.NextResponse.json({error:"Bir hata oluştu"},{status:500})}}async function y(e,{params:a}){try{let r=await (0,l.getServerSession)(u.L);if(!r?.user?.email)return o.NextResponse.json({error:"Giriş yapmanız gerekiyor"},{status:401});let t=await d.default.user.findUnique({where:{email:r.user.email}});if(!t)return o.NextResponse.json({error:"Kullanıcı bulunamadı"},{status:404});let i=await d.default.product.findUnique({where:{id:a.id}});if(!i)return o.NextResponse.json({error:"\xdcr\xfcn bulunamadı"},{status:404});if(i.userId!==t.id&&"admin"!==t.role)return o.NextResponse.json({error:"Bu işlem i\xe7in yetkiniz yok"},{status:403});let s=await e.json(),{action:n}=s;if("publish"===n)return await d.default.product.update({where:{id:a.id},data:{status:"active"}}),o.NextResponse.json({success:!0,message:"\xdcr\xfcn\xfcn\xfcz başarıyla yayına alındı!"});if("unpublish"===n)return await d.default.product.update({where:{id:a.id},data:{status:"inactive"}}),o.NextResponse.json({success:!0,message:"\xdcr\xfcn\xfcn\xfcz yayından kaldırıldı."});if("restore"===n){if(!i.deletedAt)return o.NextResponse.json({error:"Bu \xfcr\xfcn silinmemiş"},{status:400});if(Math.floor((Date.now()-i.deletedAt.getTime())/864e5)>30)return o.NextResponse.json({error:"Bu \xfcr\xfcn 30 g\xfcnden fazla \xf6nce silinmiş, geri y\xfcklenemez"},{status:400});return await d.default.product.update({where:{id:a.id},data:{deletedAt:null,deletedReason:null,status:"active"}}),o.NextResponse.json({success:!0,message:"\xdcr\xfcn\xfcn\xfcz başarıyla geri y\xfcklendi!"})}if("edit"===n){let{title:e,description:r,condition:n,images:l,checklistData:u,editReason:c}=s;if("admin"!==t.role){let e=new Date;if(e.setHours(0,0,0,0),await d.default.productEditHistory.count({where:{userId:t.id,createdAt:{gte:e}}})>=10)return o.NextResponse.json({error:"G\xfcnl\xfck d\xfczenleme limitinize ulaştınız (max 10). Yarın tekrar deneyin."},{status:429})}let p=await d.default.swapRequest.count({where:{OR:[{productId:a.id},{offeredProductId:a.id}],status:{in:["pending","accepted","meeting_set","in_progress","qr_generated"]}}}),m={},y={editCount:{increment:1},lastEditedAt:new Date,lastEditReason:c||null};if(e&&e!==i.title){if(p>0)return o.NextResponse.json({error:"Aktif takas s\xfcrecindeyken \xfcr\xfcn başlığı değiştirilemez."},{status:400});m.title={old:i.title,new:e},y.title=e}if(r&&r!==i.description&&(m.description={old:i.description?.substring(0,50),new:r.substring(0,50)},y.description=r),n&&n!==i.condition&&(m.condition={old:i.condition,new:n},y.condition=n),l&&JSON.stringify(l)!==JSON.stringify(i.images)&&(m.images={old:`${i.images.length} fotoğraf`,new:`${l.length} fotoğraf`},y.images=l),u){let e="string"==typeof u?u:JSON.stringify(u);e!==i.checklistData&&(m.checklistData={old:"g\xfcncellendi",new:"g\xfcncellendi"},y.checklistData=e)}if(0===Object.keys(m).length)return o.NextResponse.json({error:"Herhangi bir değişiklik yapılmadı."},{status:400});let k=i.valorPrice,g=!1;if(m.condition||m.checklistData)try{let a=process.env.NEXTAUTH_URL||"http://localhost:3000",t=await fetch(`${a}/api/valor/calculate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e||i.title,description:r||i.description,categoryName:"",categorySlug:"",condition:n||i.condition,city:i.city,checklistData:u||i.checklistData})});if(t.ok){let e=await t.json();e.valorPrice&&e.valorPrice!==i.valorPrice&&(k=e.valorPrice,g=!0,y.valorPrice=k,y.aiValorPrice=k,y.aiValorReason=`D\xfczenleme sonrası yeniden değerleme`,m.valorPrice={old:i.valorPrice,new:k})}}catch(e){console.error("Valor recalc error:",e)}return await d.default.$transaction([d.default.product.update({where:{id:a.id},data:y}),d.default.productEditHistory.create({data:{productId:a.id,userId:t.id,changes:JSON.stringify(m),reason:c||null,oldValor:i.valorPrice,newValor:k}})]),o.NextResponse.json({success:!0,message:"\xdcr\xfcn\xfcn\xfcz g\xfcncellendi!",changes:Object.keys(m),valorChanged:g,oldValor:i.valorPrice,newValor:k,editCount:(i.editCount||0)+1})}return o.NextResponse.json({error:"Ge\xe7ersiz işlem"},{status:400})}catch(e){return console.error("Product update error:",e),o.NextResponse.json({error:"Bir hata oluştu"},{status:500})}}async function k(e,{params:a}){try{let{searchParams:r}=new URL(e.url),t=r.get("lang")||"tr",i=await d.default.product.findUnique({where:{id:a.id},include:{category:!0,user:{select:{id:!0,name:!0,nickname:!0,image:!0,createdAt:!0,trustScore:!0,_count:{select:{products:!0}}}},_count:{select:{favorites:!0}},editHistory:{orderBy:{createdAt:"desc"},take:5,select:{changes:!0,reason:!0,oldValor:!0,newValor:!0,createdAt:!0}}}});if(!i)return o.NextResponse.json({error:"\xdcr\xfcn bulunamadı"},{status:404});await d.default.product.update({where:{id:a.id},data:{views:{increment:1}}});let s=(0,c.ij)(i,t);return o.NextResponse.json(s)}catch(e){return console.error("Product fetch error:",e),o.NextResponse.json({error:"\xdcr\xfcn y\xfcklenirken bir hata oluştu"},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/products/[id]/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:b}=g,w="/api/products/[id]/route";function E(){return(0,n.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:h})}},11826:(e,a,r)=>{r.d(a,{L:()=>u});var t=r(66291),i=r(64617),s=r(3390),n=r.n(s),o=r(83178),l=r(59521);let u={adapter:(0,i.N)(o.default),providers:[(0,t.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e,a){if(!e?.email||!e?.password)return null;let r=a?.headers?.["x-real-ip"],t=a?.headers?.["x-forwarded-for"],i=r?Array.isArray(r)?r[0]:r:t&&(Array.isArray(t)?t[0]:t).split(",").pop()?.trim()||"unknown",s=a?.headers?.["user-agent"]||"unknown";if(!(await (0,l.d5)(i,e.email)).allowed)throw await (0,l.Ky)(e.email,i,5,void 0),Error("ACCOUNT_LOCKED");let u=await o.default.user.findUnique({where:{email:e.email}});return u?await n().compare(e.password,u.password)?(await (0,l.LW)(i,u.id,u.email,s),await o.default.user.update({where:{id:u.id},data:{lastLoginAt:new Date}}),{id:u.id,email:u.email,name:u.name,role:u.role}):(await (0,l.Vm)(i,e.email,s,"Invalid password"),null):(await (0,l.Vm)(i,e.email,s,"User not found"),null)}})],session:{strategy:"jwt",maxAge:86400,updateAge:300},jwt:{maxAge:86400},callbacks:{jwt:async({token:e,user:a})=>(a&&(e.id=a.id,e.role=a.role),e),session:async({session:e,token:a})=>(e?.user&&(e.user.id=a?.id,e.user.role=a?.role),e)},pages:{signIn:"/giris"},secret:process.env.NEXTAUTH_SECRET,cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}}},23522:(e,a,r)=>{r.d(a,{Jv:()=>l,Mu:()=>o,ij:()=>n,kQ:()=>u});let t={en:{"yillik kullanilmis":"years used","yil kullanilmis":"year used","inc ekran":"inch screen",beden:"size",numara:"size",adet:"pieces",parca:"pieces",renk:"color",siyah:"black",beyaz:"white",mavi:"blue",kirmizi:"red",yesil:"green",kahverengi:"brown",gri:"gray",bej:"beige",lacivert:"navy blue",pembe:"pink",Sifir:"Brand New",Sıfır:"Brand New","Sifir Gibi":"Like New","Sıfır Gibi":"Like New",İyi:"Good",Iyi:"Good",Orta:"Fair",Elektronik:"Electronics",Giyim:"Clothing","Ev & Yasam":"Home & Living","Ev & Yaşam":"Home & Living","Spor & Outdoor":"Sports & Outdoor","Kitap & Hobi":"Books & Hobbies","Cocuk & Bebek":"Kids & Baby","\xc7ocuk & Bebek":"Kids & Baby",Oyuncak:"Toys",Mutfak:"Kitchen",Bahce:"Garden",Bahçe:"Garden","Taki & Aksesuar":"Jewelry & Accessories","Takı & Aksesuar":"Jewelry & Accessories","Beyaz Esya":"White Goods","Beyaz Eşya":"White Goods",Diger:"Other",Diğer:"Other","Bebek Arabasi":"Baby Stroller","Bebek Arabas\xfd":"Baby Stroller",Puset:"Stroller",Karyola:"Crib",Yatak:"Mattress","Mama Sandalyesi":"High Chair","Kiyafet Seti":"Clothing Set","Banyo Seti":"Bath Set","Oyun Hali":"Play Mat",Besik:"Cradle",Yorgan:"Blanket","Tasima Kanguru":"Baby Carrier","Oto Koltugu":"Car Seat","Aktivite Jimnastik":"Activity Gym","Emzirme Minderi":"Nursing Pillow","Bez Cantasi":"Diaper Bag","Biberon Seti":"Bottle Set","Park Yatagi":"Travel Crib",Kulaklik:"Headphones",Telefon:"Phone",Tablet:"Tablet",Bilgisayar:"Computer",Laptop:"Laptop",Monitör:"Monitor",Monitor:"Monitor",Televizyon:"Television",TV:"TV",Ceket:"Jacket",Elbise:"Dress",Pantolon:"Pants",Gomlek:"Shirt",Gömlek:"Shirt",Ayakkabi:"Shoes",Ayakkabý:"Shoes",Canta:"Bag",Çanta:"Bag",Saat:"Watch",Kolye:"Necklace",Yuzuk:"Ring",Yüzük:"Ring",Kupe:"Earrings",Küpe:"Earrings",Bileklik:"Bracelet",Kitap:"Book",Roman:"Novel",Oyun:"Game",Bisiklet:"Bicycle","Spor Aleti":"Sports Equipment","Yoga Mati":"Yoga Mat",Dambil:"Dumbbell",Cadir:"Tent",Çadır:"Tent","Uyku Tulumu":"Sleeping Bag",Koltuk:"Sofa",Masa:"Table",Sandalye:"Chair",Dolap:"Cabinet",Raf:"Shelf",Lamba:"Lamp",Hali:"Carpet",Halý:"Carpet",Perde:"Curtain",Ayna:"Mirror",Buzdolabi:"Refrigerator","Camasir Makinesi":"Washing Machine","Bulasik Makinesi":"Dishwasher",Mikrodalga:"Microwave",Firin:"Oven",Fýrýn:"Oven","Tost Makinesi":"Toaster","Kahve Makinesi":"Coffee Maker","Su Isitici":"Electric Kettle",Blender:"Blender",Lego:"Lego","Oyuncak Araba":"Toy Car",Bebek:"Baby Doll",Puzzle:"Puzzle",Kadin:"Women's",Kadýn:"Women's",Erkek:"Men's",Cocuk:"Children's",Çocuk:"Children's",Unisex:"Unisex","Travel sistem":"Travel system",Hafif:"Lightweight",katlanir:"foldable",sallanir:"rocking","yukseklik ayarli":"height adjustable","yikaniir kilif":"washable cover","cok gozlu":"multi-pocket","Aktif gurultu engelleyici":"Active noise cancelling","gercek deri":"genuine leather",pamuklu:"cotton",organik:"organic",muzikli:"with music",ay:"months",yas:"years",yaş:"years"},es:{"yillik kullanilmis":"a\xf1os de uso","inc ekran":"pulgadas de pantalla",beden:"talla",numara:"n\xfamero",adet:"piezas",parca:"piezas",renk:"color",siyah:"negro",beyaz:"blanco",mavi:"azul",kirmizi:"rojo",Sifir:"Nuevo","Sifir Gibi":"Como Nuevo",İyi:"Bueno",Orta:"Regular",Elektronik:"Electr\xf3nica",Giyim:"Ropa","Ev & Yasam":"Hogar y Vida","Ev & Yaşam":"Hogar y Vida","Spor & Outdoor":"Deportes y Exterior","Kitap & Hobi":"Libros y Hobbies","Cocuk & Bebek":"Ni\xf1os y Beb\xe9s","\xc7ocuk & Bebek":"Ni\xf1os y Beb\xe9s",Oyuncak:"Juguetes",Mutfak:"Cocina",Bahce:"Jard\xedn",Bahçe:"Jard\xedn","Taki & Aksesuar":"Joyas y Accesorios","Takı & Aksesuar":"Joyas y Accesorios","Beyaz Esya":"Electrodom\xe9sticos","Beyaz Eşya":"Electrodom\xe9sticos",Diger:"Otros",Diğer:"Otros","Bebek Arabasi":"Cochecito de Beb\xe9",Puset:"Carrito",Karyola:"Cuna",Yatak:"Colch\xf3n","Mama Sandalyesi":"Trona","Kiyafet Seti":"Conjunto de Ropa",Kulaklik:"Auriculares",Telefon:"Tel\xe9fono",Ceket:"Chaqueta",Elbise:"Vestido",Kadin:"Mujer",Erkek:"Hombre",Cocuk:"Ni\xf1os",ay:"meses",yas:"a\xf1os"},ca:{"yillik kullanilmis":"anys d'\xfas","inc ekran":"polzades de pantalla",beden:"talla",numara:"n\xfamero",adet:"peces",parca:"peces",renk:"color",siyah:"negre",beyaz:"blanc",mavi:"blau",kirmizi:"vermell",Sifir:"Nou","Sifir Gibi":"Com Nou",İyi:"Bo",Orta:"Regular",Elektronik:"Electr\xf2nica",Giyim:"Roba","Ev & Yasam":"Llar i Vida","Ev & Yaşam":"Llar i Vida","Spor & Outdoor":"Esports i Exterior","Kitap & Hobi":"Llibres i Hobbies","Cocuk & Bebek":"Nens i Nadons","\xc7ocuk & Bebek":"Nens i Nadons",Oyuncak:"Joguines",Mutfak:"Cuina",Bahce:"Jard\xed",Bahçe:"Jard\xed","Taki & Aksesuar":"Joies i Accessoris","Takı & Aksesuar":"Joies i Accessoris","Beyaz Esya":"Electrodom\xe8stics","Beyaz Eşya":"Electrodom\xe8stics",Diger:"Altres",Diğer:"Altres","Bebek Arabasi":"Cotxet de Nad\xf3",Puset:"Cotxet",Karyola:"Bressol",Yatak:"Matal\xe0s","Mama Sandalyesi":"Trona","Kiyafet Seti":"Conjunt de Roba",Kulaklik:"Auriculars",Telefon:"Tel\xe8fon",Ceket:"Jaqueta",Elbise:"Vestit",Kadin:"Dona",Erkek:"Home",Cocuk:"Nens",ay:"mesos",yas:"anys"}},i={new:{tr:"Sıfır",en:"Brand New",es:"Nuevo",ca:"Nou"},likeNew:{tr:"Sıfır Gibi",en:"Like New",es:"Como Nuevo",ca:"Com Nou"},good:{tr:"İyi",en:"Good",es:"Bueno",ca:"Bo"},fair:{tr:"Orta",en:"Fair",es:"Regular",ca:"Regular"}};function s(e,a){if(!e||"tr"===a)return e;let r=t[a];if(!r)return e;let i=e;for(let e of Object.keys(r).sort((e,a)=>a.length-e.length)){let a=RegExp(e,"gi");i=i.replace(a,r[e])}return i}function n(e,a){let r=e.title,t=e.description;"en"===a&&e.titleEn?r=e.titleEn:"es"===a&&e.titleEs?r=e.titleEs:"ca"===a&&e.titleCa?r=e.titleCa:"tr"!==a&&(r=s(e.title,a)),"en"===a&&e.descriptionEn?t=e.descriptionEn:"es"===a&&e.descriptionEs?t=e.descriptionEs:"ca"===a&&e.descriptionCa?t=e.descriptionCa:"tr"!==a&&(t=s(e.description,a));let n=e.condition?i[e.condition]?.[a]||e.condition:"",o=e.category?.name;return e.category&&("en"===a&&e.category.nameEn?o=e.category.nameEn:"es"===a&&e.category.nameEs?o=e.category.nameEs:"ca"===a&&e.category.nameCa&&(o=e.category.nameCa)),{...e,translatedTitle:r,translatedDescription:t,translatedCondition:n,translatedCategory:o}}function o(e,a){return e.map(e=>n(e,a))}function l(e,a){if("en"===a&&e.nameEn)return e.nameEn;if("es"===a&&e.nameEs)return e.nameEs;if("ca"===a&&e.nameCa)return e.nameCa;if("tr"!==a&&t[a]){let r=t[a];if(r[e.name])return r[e.name];let i=e.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(r[i])return r[i]}return e.name}function u(e,a){let r=e.name,t=e.address;return"en"===a?(r=e.nameEn||e.name,t=e.addressEn||e.address):"es"===a?(r=e.nameEs||e.name,t=e.addressEs||e.address):"ca"===a&&(r=e.nameCa||e.name,t=e.addressCa||e.address),{translatedName:r,translatedAddress:t}}}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[8412,7609,3390,1472,9521],()=>r(462));module.exports=t})();