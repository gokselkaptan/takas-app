"use strict";(()=>{var e={};e.id=2330,e.ids=[2330],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63504:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>l,revalidate:()=>u});var s=r(79182),i=r(72007),o=r(56719),a=r(93442),c=r(83178);let u=60;async function l(e){try{let e=await c.default.product.findMany({where:{status:"active"},select:{city:!0,district:!0}}),t=new Map,r=new Map;e.forEach(e=>{let n=(e.city||"").trim();if(!n)return;t.set(n,(t.get(n)||0)+1);let s=(e.district||"").trim();if(!s)return;r.has(n)||r.set(n,new Map);let i=r.get(n);i.set(s,(i.get(s)||0)+1)});let n=Array.from(t.entries()).map(([e,t])=>({name:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,20),s={};return r.forEach((e,t)=>{s[t]=Array.from(e.entries()).map(([e,t])=>({name:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,15)}),a.NextResponse.json({cities:n,districtsByCity:s})}catch(e){return console.error("Filters error:",e),a.NextResponse.json({cities:[],districtsByCity:{}})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/products/filters/route",pathname:"/api/products/filters",filename:"route",bundlePath:"app/api/products/filters/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/products/filters/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:f}=d,y="/api/products/filters/route";function h(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},83178:(e,t,r)=>{r.r(t),r.d(t,{default:()=>c});var n=r(53524);let s=globalThis,i="phase-production-build"===process.env.NEXT_PHASE||!0,o=s.prisma??(()=>{let e=new n.PrismaClient({log:["error"],datasources:{db:{url:function(){let e=process.env.DATABASE_URL||"";if(e.includes("connection_limit")||e.includes("pool_timeout"))return e;let t=e.includes("?")?"&":"?";return`${e}${t}connection_limit=${i?1:5}&pool_timeout=${i?60:10}&connect_timeout=5&socket_timeout=10&pgbouncer=true&statement_cache_size=0`}()}}});return e.$use(async(t,r)=>{let n=0;for(;n<=5;)try{let e=await r(t);return s.lastConnectTime=Date.now(),e}catch(r){let t=r instanceof Error?r.message:String(r);if((t.includes("idle-session timeout")||t.includes("terminating connection")||t.includes("ECONNRESET")||t.includes("Connection refused")||t.includes("connection closed")||t.includes("socket")||t.includes("ETIMEDOUT")||t.includes("connection timed out")||t.includes("prepared statement"))&&n<5){if(n++,console.log(`[Prisma] Connection error, retry ${n}/5: ${t.substring(0,100)}`),n>=2)try{await e.$disconnect(),await e.$connect(),console.log("[Prisma] Reconnected successfully")}catch{}await new Promise(e=>setTimeout(e,100*Math.pow(2,n-1)));continue}throw r}}),e})();s.prisma=o,"undefined"!=typeof process&&process.on("beforeExit",async()=>{await o.$disconnect()});let a=null;"undefined"==typeof process||i||!a&&(i||(a=setInterval(async()=>{try{await o.$queryRaw`SELECT 1`}catch(e){console.warn("[Prisma KeepAlive] Bağlantı hatası, yeniden bağlanılıyor:",e.message?.substring(0,80));try{await o.$connect(),console.log("[Prisma KeepAlive] Yeniden bağlantı başarılı")}catch(e){console.error("[Prisma KeepAlive] Yeniden bağlantı başarısız!")}}},6e4)).unref());let c=o}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8412,7609],()=>r(63504));module.exports=n})();