"use strict";(()=>{var e={};e.id=8880,e.ids=[8880],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},33283:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>v,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var s={};n.r(s),n.d(s,{GET:()=>l,revalidate:()=>u});var a=n(79182),i=n(72007),r=n(56719),o=n(93442),c=n(83178);let u=300;async function l(){try{let[e,t,n]=await Promise.all([c.default.swapRequest.count({where:{status:"completed"}}),c.default.product.count({where:{status:"active"}}),c.default.product.groupBy({by:["city"],where:{status:"active",city:{not:""}}})]);return o.NextResponse.json({swaps:Math.max(e,1),active:t,cities:n.length})}catch{return o.NextResponse.json({swaps:150,active:140,cities:41})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/stats/live/route",pathname:"/api/stats/live",filename:"route",bundlePath:"app/api/stats/live/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/stats/live/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h}=p,v="/api/stats/live/route";function f(){return(0,r.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},83178:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var s=n(53524);let a=globalThis,i="phase-production-build"===process.env.NEXT_PHASE||!0,r=a.prisma??(()=>{let e=new s.PrismaClient({log:["error"],datasources:{db:{url:function(){let e=process.env.DATABASE_URL||"";if(e.includes("connection_limit")||e.includes("pool_timeout"))return e;let t=e.includes("?")?"&":"?";return`${e}${t}connection_limit=${i?1:10}&pool_timeout=${i?60:20}&connect_timeout=10&socket_timeout=20&pgbouncer=true&statement_cache_size=0`}()}}});return e.$use(async(t,n)=>{let s=0;for(;s<=5;)try{let e=await n(t);return a.lastConnectTime=Date.now(),e}catch(n){let t=n instanceof Error?n.message:String(n);if((t.includes("idle-session timeout")||t.includes("terminating connection")||t.includes("ECONNRESET")||t.includes("Connection refused")||t.includes("connection closed")||t.includes("socket")||t.includes("ETIMEDOUT")||t.includes("connection timed out")||t.includes("prepared statement"))&&s<5){if(s++,console.log(`[Prisma] Connection error, retry ${s}/5: ${t.substring(0,100)}`),s>=2)try{await e.$disconnect(),await e.$connect(),console.log("[Prisma] Reconnected successfully")}catch{}await new Promise(e=>setTimeout(e,100*Math.pow(2,s-1)));continue}throw n}}),e})();a.prisma=r,"undefined"!=typeof process&&process.on("beforeExit",async()=>{await r.$disconnect()});let o=null;"undefined"==typeof process||i||!o&&(i||(o=setInterval(async()=>{try{await r.$queryRaw`SELECT 1`}catch(e){console.warn("[Prisma KeepAlive] Bağlantı hatası, yeniden bağlanılıyor:",e.message?.substring(0,80));try{await r.$connect(),console.log("[Prisma KeepAlive] Yeniden bağlantı başarılı")}catch(e){console.error("[Prisma KeepAlive] Yeniden bağlantı başarısız!")}}},12e4)).unref());let c=r}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),s=t.X(0,[8412,7609],()=>n(33283));module.exports=s})();