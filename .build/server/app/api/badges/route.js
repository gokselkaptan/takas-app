"use strict";(()=>{var e={};e.id=6073,e.ids=[6073],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},35142:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>R,staticGenerationAsyncStorage:()=>j});var s={};t.r(s),t.d(s,{GET:()=>c,PATCH:()=>x,POST:()=>g});var a=t(79182),n=t(72007),i=t(56719),o=t(93442),u=t(57978),d=t(11826),p=t(83178),l=t(58034);async function c(e){try{let r=await (0,u.getServerSession)(d.L),t=r?.user?.id,{searchParams:s}=new URL(e.url),a=s.get("userId"),n=s.get("type"),i=s.get("check"),c=await p.default.badge.count();if(0===c&&await (0,l.b0)(),"new"===i){if(!t)return o.NextResponse.json({newBadges:[]});try{let e=await p.default.userBadge.findMany({where:{userId:t,notified:!1},include:{badge:!0},orderBy:{earnedAt:"desc"},take:5});return o.NextResponse.json({newBadges:e.map(e=>({id:e.id,name:e.badge.name,icon:e.badge.icon,tier:e.badge.tier,valorReward:e.badge.valorReward,description:e.badge.description}))})}catch{return o.NextResponse.json({newBadges:[]})}}if("all"===n){let e=await p.default.badge.findMany({where:{isActive:!0,isSecret:!1},orderBy:[{category:"asc"},{sortOrder:"asc"}]});return o.NextResponse.json(e)}if("check"===n&&t){let e=await (0,l.ub)(t);return o.NextResponse.json(e)}let g=a||t;if(!g)return o.NextResponse.json({error:"Kullanıcı ID gerekli"},{status:400});if(t===g){let e=await (0,l.Jd)(g);return o.NextResponse.json(e)}{let e=await p.default.userBadge.findMany({where:{userId:g},include:{badge:!0},orderBy:{earnedAt:"desc"}});return o.NextResponse.json(e.map(e=>({...e.badge,earned:!0,earnedAt:e.earnedAt,isDisplayed:e.isDisplayed})))}}catch(e){return console.error("Badge API error:",e),o.NextResponse.json({error:"Rozetler y\xfcklenemedi"},{status:500})}}async function g(e){try{let r=await (0,u.getServerSession)(d.L),t=r?.user?.id;if(!t)return o.NextResponse.json({error:"Giriş yapmalısınız"},{status:401});let{badgeId:s,isDisplayed:a}=await e.json();if(!s)return o.NextResponse.json({error:"Badge ID gerekli"},{status:400});let n=await p.default.userBadge.findFirst({where:{userId:t,badgeId:s}});if(!n)return o.NextResponse.json({error:"Bu rozete sahip değilsiniz"},{status:403});if(a&&await p.default.userBadge.count({where:{userId:t,isDisplayed:!0,NOT:{badgeId:s}}})>=5)return o.NextResponse.json({error:"En fazla 5 rozet g\xf6sterebilirsiniz"},{status:400});return await p.default.userBadge.update({where:{id:n.id},data:{isDisplayed:a}}),o.NextResponse.json({success:!0})}catch(e){return console.error("Badge update error:",e),o.NextResponse.json({error:"Rozet g\xfcncellenemedi"},{status:500})}}async function x(e){try{let r=await (0,u.getServerSession)(d.L),t=r?.user?.id;if(!t)return o.NextResponse.json({error:"Giriş yapmalısınız"},{status:401});let{badgeId:s,action:a}=await e.json();if(!s)return o.NextResponse.json({error:"Badge ID gerekli"},{status:400});if("seen"===a){let e=await p.default.userBadge.findFirst({where:{id:s,userId:t}});if(!e)return o.NextResponse.json({error:"Rozet bulunamadı"},{status:404});return await p.default.userBadge.update({where:{id:e.id},data:{notified:!0}}),o.NextResponse.json({success:!0})}return o.NextResponse.json({error:"Ge\xe7ersiz işlem"},{status:400})}catch(e){return console.error("Badge PATCH error:",e),o.NextResponse.json({error:"İşlem başarısız"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/badges/route",pathname:"/api/badges",filename:"route",bundlePath:"app/api/badges/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/badges/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:j,serverHooks:R}=f,y="/api/badges/route";function h(){return(0,i.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:j})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8412,7609,3390,1472,9521,4007],()=>t(35142));module.exports=s})();