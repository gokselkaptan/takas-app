"use strict";(()=>{var e={};e.id=5870,e.ids=[5870],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},50093:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>j,staticGenerationAsyncStorage:()=>R});var s={};r.r(s),r.d(s,{GET:()=>x,PATCH:()=>q,POST:()=>w,dynamic:()=>m});var a=r(79182),i=r(72007),n=r(56719),o=r(93442),u=r(57978),p=r(83178),d=r(11826),l=r(83940),c=r(68247);let m="force-dynamic";async function x(e){try{let t=await (0,u.getServerSession)(d.L);if(!t?.user?.email)return o.NextResponse.json({error:"Giriş yapmalısınız"},{status:401});let r=await p.default.user.findUnique({where:{email:t.user.email}});if(!r)return o.NextResponse.json({error:"Kullanıcı bulunamadı"},{status:404});let{searchParams:s}=new URL(e.url),a=s.get("swapId");if(!a)return o.NextResponse.json({error:"swapId gerekli"},{status:400});let i=await p.default.swapRequest.findUnique({where:{id:a},include:{disputes:{orderBy:{createdAt:"desc"},take:5}}});if(!i)return o.NextResponse.json({error:"Takas bulunamadı"},{status:404});if(i.requesterId!==r.id&&i.ownerId!==r.id&&"admin"!==r.role)return o.NextResponse.json({error:"Yetkisiz erişim"},{status:403});let n=await (0,l.CW)(a),m=await (0,l.zm)(a);return o.NextResponse.json({swap:{id:i.id,status:i.status,deliveredAt:i.deliveredAt,riskTier:i.riskTier,autoCompleteEligible:i.autoCompleteEligible},disputeWindow:{endsAt:i.disputeWindowEndsAt,hoursTotal:c.kg,remainingHours:n?.remainingHours||0,isActive:n?.isInDisputeWindow||!1,canOpenDispute:n?.canOpenDispute||!1,canAutoComplete:n?.canAutoComplete||!1},disputes:i.disputes.map(e=>({id:e.id,type:e.type,description:e.description,status:e.status,createdAt:e.createdAt})),statusHistory:m.map(e=>({id:e.id,fromStatus:e.fromStatus,toStatus:e.toStatus,reason:e.reason,createdAt:e.createdAt})),currentUserId:r.id,isRequester:i.requesterId===r.id,isOwner:i.ownerId===r.id,isAdmin:"admin"===r.role})}catch(e){return console.error("Get dispute info error:",e),o.NextResponse.json({error:"Dispute bilgisi y\xfcklenirken hata oluştu"},{status:500})}}async function w(e){try{let t=await (0,u.getServerSession)(d.L);if(!t?.user?.email)return o.NextResponse.json({error:"Giriş yapmalısınız"},{status:401});let r=await p.default.user.findUnique({where:{email:t.user.email}});if(!r)return o.NextResponse.json({error:"Kullanıcı bulunamadı"},{status:404});let{swapId:s,reason:a,description:i}=await e.json();if(!s||!a||!i)return o.NextResponse.json({error:"swapId, reason ve description gerekli"},{status:400});if(!["item_not_received","item_damaged","item_not_as_described","wrong_item","fraud","other"].includes(a))return o.NextResponse.json({error:"Ge\xe7ersiz itiraz sebebi"},{status:400});if(i.length<20)return o.NextResponse.json({error:"A\xe7ıklama en az 20 karakter olmalı"},{status:400});let n=await (0,l.MW)(s,r.id,a,i);if(!n.success)return o.NextResponse.json({error:n.error},{status:400});return o.NextResponse.json({success:!0,message:"İtirazınız a\xe7ıldı. En kısa s\xfcrede incelenecektir.",newStatus:n.newStatus})}catch(e){return console.error("Open dispute error:",e),o.NextResponse.json({error:"İtiraz a\xe7ılırken hata oluştu"},{status:500})}}async function q(e){try{let t=await (0,u.getServerSession)(d.L);if(!t?.user?.email)return o.NextResponse.json({error:"Giriş yapmalısınız"},{status:401});let r=await p.default.user.findUnique({where:{email:t.user.email}});if(!r||"admin"!==r.role)return o.NextResponse.json({error:"Yetkisiz erişim"},{status:403});let{disputeId:s,status:a,resolution:i,compensationAmount:n}=await e.json();if(!s||!a)return o.NextResponse.json({error:"disputeId ve status gerekli"},{status:400});if(!["open","investigating","resolved","rejected"].includes(a))return o.NextResponse.json({error:"Ge\xe7ersiz durum"},{status:400});let l=await p.default.disputeReport.update({where:{id:s},data:{status:a,resolution:i}});return"resolved"===a&&(await p.default.swapRequest.update({where:{id:l.swapRequestId},data:{status:"resolved"}}),n&&n>0&&(await p.default.user.update({where:{id:l.reporterId},data:{valorBalance:{increment:n}}}),await p.default.valorTransaction.create({data:{toUserId:l.reporterId,amount:n,netAmount:n,type:"compensation",description:`İtiraz tazminatı - ${l.type}`,swapRequestId:l.swapRequestId}}))),o.NextResponse.json({success:!0,dispute:{id:l.id,status:l.status,resolution:l.resolution}})}catch(e){return console.error("Update dispute error:",e),o.NextResponse.json({error:"İtiraz g\xfcncellenirken hata oluştu"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/swap-requests/dispute/route",pathname:"/api/swap-requests/dispute",filename:"route",bundlePath:"app/api/swap-requests/dispute/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/swap-requests/dispute/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:R,serverHooks:j}=f,h="/api/swap-requests/dispute/route";function y(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:R})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8412,7609,3390,1472,7853,9521,9628,5578],()=>r(50093));module.exports=s})();