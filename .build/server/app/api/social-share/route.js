"use strict";(()=>{var e={};e.id=2752,e.ids=[2752],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},58068:(e,a,r)=>{r.r(a),r.d(a,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>R,staticGenerationAsyncStorage:()=>v});var t={};r.r(t),r.d(t,{GET:()=>c,POST:()=>h});var s=r(79182),o=r(72007),l=r(56719),i=r(93442),n=r(57978),d=r(11826),u=r(83178),w=r(53184);let p=[{sharesForReward:0,valorReward:0,maxDailyValor:0},{sharesForReward:10,valorReward:1,maxDailyValor:2},{sharesForReward:7,valorReward:1,maxDailyValor:3},{sharesForReward:5,valorReward:2,maxDailyValor:5},{sharesForReward:5,valorReward:2,maxDailyValor:8},{sharesForReward:5,valorReward:3,maxDailyValor:10}];async function c(e){try{let e=await (0,n.getServerSession)(d.L);if(!e?.user?.email)return i.NextResponse.json({error:"Unauthorized"},{status:401});let a=await u.default.user.findUnique({where:{email:e.user.email},select:{id:!0}});if(!a)return i.NextResponse.json({error:"User not found"},{status:404});let r=await u.default.socialShare.count({where:{userId:a.id}}),t=new Date;t.setHours(0,0,0,0);let s=await u.default.socialShare.count({where:{userId:a.id,createdAt:{gte:t}}}),o=await u.default.socialShare.aggregate({where:{userId:a.id,createdAt:{gte:t}},_sum:{valorAwarded:!0}}),l=await u.default.socialShare.aggregate({where:{userId:a.id},_sum:{valorAwarded:!0}}),c=await u.default.socialShare.groupBy({by:["platform"],where:{userId:a.id},_count:{id:!0}}),h=await (0,w.FR)(a.id),m=p[h.level]||p[0],x=m.sharesForReward>0?m.sharesForReward-r%m.sharesForReward:0,v=m.maxDailyValor>0&&(o._sum.valorAwarded||0)<m.maxDailyValor;return i.NextResponse.json({totalShares:r,todayShares:s,todayValorEarned:o._sum.valorAwarded||0,totalValorEarned:l._sum.valorAwarded||0,sharesUntilReward:x===m.sharesForReward?0:x,sharesForReward:m.sharesForReward,valorReward:m.valorReward,maxDailyShares:20,maxDailyValor:m.maxDailyValor,canEarnMoreToday:v,userLevel:h.level,levelName:h.name,platformStats:c.reduce((e,a)=>(e[a.platform]=a._count.id,e),{})})}catch(e){return console.error("Social share stats error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function h(e){try{let a=await (0,n.getServerSession)(d.L);if(!a?.user?.email)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{platform:r,shareType:t,contentId:s,shareUrl:o}=await e.json();if(!r||!["twitter","facebook","instagram","whatsapp","linkedin"].includes(r))return i.NextResponse.json({error:"Invalid platform"},{status:400});if(!t||!["profile","product","swap","platform","swap_history"].includes(t))return i.NextResponse.json({error:"Invalid share type"},{status:400});let l=await u.default.user.findUnique({where:{email:a.user.email},select:{id:!0,valorBalance:!0}});if(!l)return i.NextResponse.json({error:"User not found"},{status:404});let c=new Date;c.setHours(0,0,0,0);let h=await u.default.socialShare.count({where:{userId:l.id,createdAt:{gte:c}}});if(h>=20)return i.NextResponse.json({error:"G\xfcnl\xfck paylaÅŸÄ±m limitine ulaÅŸtÄ±nÄ±z",valorAwarded:0,todayShares:h,limitReached:!0},{status:200});let m=await u.default.socialShare.aggregate({where:{userId:l.id,createdAt:{gte:c}},_sum:{valorAwarded:!0}}),x=await u.default.socialShare.count({where:{userId:l.id}}),v=await (0,w.FR)(l.id),R=p[v.level]||p[0];if(0===R.sharesForReward){let e=await u.default.socialShare.create({data:{userId:l.id,platform:r,shareType:t,contentId:s||null,shareUrl:o||null,valorAwarded:0}});return i.NextResponse.json({success:!0,shareId:e.id,valorAwarded:0,totalShares:x+1,todayShares:h+1,sharesUntilReward:0,sharesForReward:0,valorReward:0,message:"PaylaÅŸÄ±m kaydedildi! Ä°lk takasÄ±nÄ± tamamla ve paylaÅŸÄ±m bonusu kazan! \uD83D\uDD13",levelRequired:!0,currentLevel:v.level})}let y=0,f=x+1;if(f%R.sharesForReward==0){let e=m._sum.valorAwarded||0;e<R.maxDailyValor&&(y=Math.min(R.valorReward,R.maxDailyValor-e))}let g=await u.default.socialShare.create({data:{userId:l.id,platform:r,shareType:t,contentId:s||null,shareUrl:o||null,valorAwarded:y}});y>0&&await u.default.user.update({where:{id:l.id},data:{valorBalance:{increment:y},totalValorEarned:{increment:y}}});let S=R.sharesForReward-f%R.sharesForReward;return i.NextResponse.json({success:!0,shareId:g.id,valorAwarded:y,totalShares:f,todayShares:h+1,sharesUntilReward:S===R.sharesForReward?0:S,sharesForReward:R.sharesForReward,valorReward:R.valorReward,message:y>0?`Tebrikler! +${y} Valor kazandÄ±nÄ±z! ðŸŽ‰`:`PaylaÅŸÄ±m kaydedildi. ${S} paylaÅŸÄ±m daha yapÄ±n ve +${R.valorReward} Valor kazanÄ±n!`})}catch(e){return console.error("Social share error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/social-share/route",pathname:"/api/social-share",filename:"route",bundlePath:"app/api/social-share/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/social-share/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:v,serverHooks:R}=m,y="/api/social-share/route";function f(){return(0,l.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:v})}},11826:(e,a,r)=>{r.d(a,{L:()=>d});var t=r(66291),s=r(64617),o=r(3390),l=r.n(o),i=r(83178),n=r(59521);let d={adapter:(0,s.N)(i.default),providers:[(0,t.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e,a){if(!e?.email||!e?.password)return null;let r=a?.headers?.["x-real-ip"],t=a?.headers?.["x-forwarded-for"],s=r?Array.isArray(r)?r[0]:r:t&&(Array.isArray(t)?t[0]:t).split(",").pop()?.trim()||"unknown",o=a?.headers?.["user-agent"]||"unknown";if(!(await (0,n.d5)(s,e.email)).allowed)throw await (0,n.Ky)(e.email,s,5,void 0),Error("ACCOUNT_LOCKED");let d=await i.default.user.findUnique({where:{email:e.email}});return d?await l().compare(e.password,d.password)?(await (0,n.LW)(s,d.id,d.email,o),await i.default.user.update({where:{id:d.id},data:{lastLoginAt:new Date}}),{id:d.id,email:d.email,name:d.name,role:d.role}):(await (0,n.Vm)(s,e.email,o,"Invalid password"),null):(await (0,n.Vm)(s,e.email,o,"User not found"),null)}})],session:{strategy:"jwt",maxAge:86400,updateAge:300},jwt:{maxAge:86400},callbacks:{jwt:async({token:e,user:a})=>(a&&(e.id=a.id,e.role=a.role),e),session:async({session:e,token:a})=>(e?.user&&(e.user.id=a?.id,e.user.role=a?.role),e)},pages:{signIn:"/giris"},secret:process.env.NEXTAUTH_SECRET,cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}}}};var a=require("../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[8412,7609,3390,1472,9521,3184],()=>r(58068));module.exports=t})();