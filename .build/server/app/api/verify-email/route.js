"use strict";(()=>{var e={};e.id=3024,e.ids=[3024],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},41309:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{POST:()=>d,dynamic:()=>c});var a=r(79182),o=r(72007),i=r(56719),s=r(93442),u=r(83178),l=r(53184);let c="force-dynamic";async function d(e){try{let{email:t,code:r}=await e.json()??{};if(!t||!r)return s.NextResponse.json({error:"Email ve doÄŸrulama kodu gerekli"},{status:400});let n=await u.default.user.findUnique({where:{email:t}});if(!n)return s.NextResponse.json({error:"KullanÄ±cÄ± bulunamadÄ±"},{status:404});if(n.emailVerified)return s.NextResponse.json({error:"Email zaten doÄŸrulanmÄ±ÅŸ"},{status:400});if(!n.verificationCode||!n.verificationCodeExpiry)return s.NextResponse.json({error:"DoÄŸrulama kodu bulunamadÄ±, l\xfctfen tekrar kayÄ±t olun"},{status:400});if(new Date>n.verificationCodeExpiry)return s.NextResponse.json({error:"DoÄŸrulama kodu s\xfcresi dolmuÅŸ, l\xfctfen yeni kod isteyin"},{status:400});if(n.verificationCode!==r)return s.NextResponse.json({error:"Ge\xe7ersiz doÄŸrulama kodu"},{status:400});await u.default.user.update({where:{email:t},data:{emailVerified:new Date,verificationCode:null,verificationCodeExpiry:null}});let a=!1;try{a=await (0,l.UE)(n.id)}catch(e){console.error("HoÅŸgeldin bonusu hatasÄ±:",e)}return s.NextResponse.json({success:!0,message:a?`Email baÅŸarÄ±yla doÄŸrulandÄ±! ðŸŽ‰ ${l.p1} Valor hoÅŸgeldin bonusu hesabÄ±nÄ±za eklendi.`:"Email baÅŸarÄ±yla doÄŸrulandÄ±",welcomeBonus:a?l.p1:0})}catch(e){return console.error("Verification error:",e),s.NextResponse.json({error:"DoÄŸrulama sÄ±rasÄ±nda bir hata oluÅŸtu"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/verify-email/route",pathname:"/api/verify-email",filename:"route",bundlePath:"app/api/verify-email/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/verify-email/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:y}=p,v="/api/verify-email/route";function h(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},83178:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var n=r(53524);let a=globalThis,o="phase-production-build"===process.env.NEXT_PHASE||!0,i=a.prisma??(()=>{let e=new n.PrismaClient({log:["error"],datasources:{db:{url:function(){let e=process.env.DATABASE_URL||"";if(e.includes("connection_limit")||e.includes("pool_timeout"))return e;let t=e.includes("?")?"&":"?";return`${e}${t}connection_limit=${o?1:5}&pool_timeout=${o?60:10}&connect_timeout=5&socket_timeout=10&pgbouncer=true&statement_cache_size=0`}()}}});return e.$use(async(t,r)=>{let n=0;for(;n<=5;)try{let e=await r(t);return a.lastConnectTime=Date.now(),e}catch(r){let t=r instanceof Error?r.message:String(r);if((t.includes("idle-session timeout")||t.includes("terminating connection")||t.includes("ECONNRESET")||t.includes("Connection refused")||t.includes("connection closed")||t.includes("socket")||t.includes("ETIMEDOUT")||t.includes("connection timed out")||t.includes("prepared statement"))&&n<5){if(n++,console.log(`[Prisma] Connection error, retry ${n}/5: ${t.substring(0,100)}`),n>=2)try{await e.$disconnect(),await e.$connect(),console.log("[Prisma] Reconnected successfully")}catch{}await new Promise(e=>setTimeout(e,100*Math.pow(2,n-1)));continue}throw r}}),e})();a.prisma=i,"undefined"!=typeof process&&process.on("beforeExit",async()=>{await i.$disconnect()});let s=null;"undefined"==typeof process||o||!s&&(o||(s=setInterval(async()=>{try{await i.$queryRaw`SELECT 1`}catch(e){console.warn("[Prisma KeepAlive] BaÄŸlantÄ± hatasÄ±, yeniden baÄŸlanÄ±lÄ±yor:",e.message?.substring(0,80));try{await i.$connect(),console.log("[Prisma KeepAlive] Yeniden baÄŸlantÄ± baÅŸarÄ±lÄ±")}catch(e){console.error("[Prisma KeepAlive] Yeniden baÄŸlantÄ± baÅŸarÄ±sÄ±z!")}}},6e4)).unref());let u=i}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8412,7609,3184],()=>r(41309));module.exports=n})();