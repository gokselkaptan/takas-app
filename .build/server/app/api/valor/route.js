"use strict";(()=>{var e={};e.id=6114,e.ids=[6114],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},79748:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>v,routeModule:()=>f,serverHooks:()=>j,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>w,POST:()=>x,dynamic:()=>m});var a=r(79182),n=r(72007),o=r(56719),i=r(93442),u=r(57978),l=r(83178),p=r(11826),d=r(53184);let m="force-dynamic",c=new Map;async function w(e){try{let{searchParams:t}=new URL(e.url),r=t.get("action")||"balance";if("brackets"===r)return i.NextResponse.json({brackets:d.w.map((e,t)=>({level:t+1,minAmount:0===t?0:d.w[t-1].limit+1,maxAmount:e.limit===1/0?"SÄ±nÄ±rsÄ±z":e.limit,rate:`%${(100*e.rate).toFixed(1)}`})),constants:{welcomeBonus:d.p1,surveyBonus:d.fj,referralBonus:d.R2}});if("preview"===r){let e=parseInt(t.get("amount")||"0");if(e<=0)return i.NextResponse.json({error:"Ge\xe7erli bir miktar girin"},{status:400});let r=(0,d.previewSwapFee)(e);return i.NextResponse.json(r)}let s=await (0,u.getServerSession)(p.L);if(!s?.user?.email)return i.NextResponse.json({error:"GiriÅŸ yapmalÄ±sÄ±nÄ±z"},{status:401});let a=await l.default.user.findUnique({where:{email:s.user.email},select:{id:!0,valorBalance:!0,trustScore:!0,role:!0,welcomeBonusGiven:!0,surveyCompleted:!0,lastActiveAt:!0,createdAt:!0}});if(!a)return i.NextResponse.json({error:"KullanÄ±cÄ± bulunamadÄ±"},{status:404});if(!function(e){let t=Date.now(),r=c.get(e);return!r||t>r.resetAt?(c.set(e,{count:1,resetAt:t+6e4}),!0):!(r.count>=20)&&(r.count++,!0)}(a.id))return i.NextResponse.json({error:"\xc7ok fazla istek. 1 dakika bekleyin."},{status:429});if("balance"===r)return await l.default.user.update({where:{id:a.id},data:{lastActiveAt:new Date}}),i.NextResponse.json({balance:a.valorBalance,trustScore:a.trustScore,welcomeBonusGiven:a.welcomeBonusGiven,surveyCompleted:a.surveyCompleted,pendingBonuses:{survey:a.surveyCompleted?0:d.fj},memberSince:a.createdAt});if("bonus_status"===r){let e=await (0,d.pL)(a.id);return i.NextResponse.json(e)}if("achievements"===r){let e=await (0,d.nx)(a.id);return i.NextResponse.json(e)}if("user_level"===r){if(!d.WJ)return i.NextResponse.json({level:1,name:"Aktif",emoji:"â­",dailyBonus:3,monthlyCap:999,swapCount:0,progress:100});let e=await (0,d.FR)(a.id),t=d.F6.findIndex(t=>t.level===e.level)+1,r=t<d.F6.length?d.F6[t]:null,s=r?Math.max(0,r.minSwaps-e.swapCount):0,n=r?Math.min(100,Math.round(e.swapCount/r.minSwaps*100)):100,o=await (0,d.JW)(a.id);return i.NextResponse.json({level:e.level,name:e.name,emoji:e.emoji,dailyBonus:e.dailyBonus,productBonus:e.productBonus,reviewBonus:e.reviewBonus,referralBonus:e.referralBonus,swapBonusMin:e.swapBonusMin,swapBonusMax:e.swapBonusMax,streakEnabled:e.streakEnabled,monthlyCap:e.monthlyCap,monthlyUsed:o,monthlyRemaining:Math.max(0,e.monthlyCap-o),swapCount:e.swapCount,swapsToNext:s,progress:n,nextLevel:r?{level:r.level,name:r.name,emoji:r.emoji,minSwaps:r.minSwaps}:null})}if("task_status"===r){let e=new Date;e.setHours(0,0,0,0);let t=await l.default.valorTransaction.findMany({where:{toUserId:a.id,createdAt:{gte:e},type:{in:["daily_bonus","product_bonus","review_bonus","referral_bonus"]}},select:{type:!0}});return i.NextResponse.json({"daily-login":t.some(e=>"daily_bonus"===e.type),"add-product":t.some(e=>"product_bonus"===e.type),"write-review":t.some(e=>"review_bonus"===e.type),"invite-friend":t.some(e=>"referral_bonus"===e.type)})}if("history"===r){let e=parseInt(t.get("limit")||"20"),r=parseInt(t.get("offset")||"0"),s=await (0,d.pt)(a.id,e,r),n=await l.default.valorTransaction.count({where:{OR:[{fromUserId:a.id},{toUserId:a.id}]}});return i.NextResponse.json({transactions:s,total:n,limit:e,offset:r,hasMore:r+e<n})}if("stats"===r){if("admin"!==a.role)return i.NextResponse.json({error:"Yetkiniz yok"},{status:403});let e=await (0,d.fP)();return i.NextResponse.json(e)}return i.NextResponse.json({error:"Ge\xe7ersiz action"},{status:400})}catch(e){return console.error("Valor API error:",e),i.NextResponse.json({error:"Bir hata oluÅŸtu"},{status:500})}}async function x(e){try{let t=await (0,u.getServerSession)(p.L);if(!t?.user?.email)return i.NextResponse.json({error:"GiriÅŸ yapmalÄ±sÄ±nÄ±z"},{status:401});let r=await l.default.user.findUnique({where:{email:t.user.email}});if(!r)return i.NextResponse.json({error:"KullanÄ±cÄ± bulunamadÄ±"},{status:404});let s=await e.json(),{action:a}=s;if("claim_survey_bonus"===a){if(r.surveyCompleted)return i.NextResponse.json({error:"Anket bonusu zaten alÄ±nmÄ±ÅŸ"},{status:400});if(await (0,d.Of)(r.id))return i.NextResponse.json({success:!0,message:`ðŸŽ‰ ${d.fj} Valor anket bonusu hesabÄ±nÄ±za eklendi!`,bonus:d.fj});return i.NextResponse.json({error:"Bonus verilemedi"},{status:400})}if("claim_daily_bonus"===a){let e=await (0,d.dO)(r.id);if(e.success)return i.NextResponse.json({success:!0,message:e.message,bonus:e.bonus});return i.NextResponse.json({error:e.message},{status:400})}if("claim_achievement"===a){let{achievementId:e}=s;if(!e)return i.NextResponse.json({error:"BaÅŸarÄ± ID gerekli"},{status:400});let t=await (0,d.WT)(r.id,e);if(t.success)return i.NextResponse.json({success:!0,message:t.message,bonus:t.bonus});return i.NextResponse.json({error:t.message},{status:400})}return i.NextResponse.json({error:"Ge\xe7ersiz action"},{status:400})}catch(e){return console.error("Valor POST error:",e),i.NextResponse.json({error:"Bir hata oluÅŸtu"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/valor/route",pathname:"/api/valor",filename:"route",bundlePath:"app/api/valor/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/valor/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:y,serverHooks:j}=f,h="/api/valor/route";function g(){return(0,o.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:y})}},11826:(e,t,r)=>{r.d(t,{L:()=>l});var s=r(66291),a=r(64617),n=r(3390),o=r.n(n),i=r(83178),u=r(59521);let l={adapter:(0,a.N)(i.default),providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e,t){if(!e?.email||!e?.password)return null;let r=t?.headers?.["x-real-ip"],s=t?.headers?.["x-forwarded-for"],a=r?Array.isArray(r)?r[0]:r:s&&(Array.isArray(s)?s[0]:s).split(",").pop()?.trim()||"unknown",n=t?.headers?.["user-agent"]||"unknown";if(!(await (0,u.d5)(a,e.email)).allowed)throw await (0,u.Ky)(e.email,a,5,void 0),Error("ACCOUNT_LOCKED");let l=await i.default.user.findUnique({where:{email:e.email}});return l?await o().compare(e.password,l.password)?(await (0,u.LW)(a,l.id,l.email,n),await i.default.user.update({where:{id:l.id},data:{lastLoginAt:new Date}}),{id:l.id,email:l.email,name:l.name,role:l.role}):(await (0,u.Vm)(a,e.email,n,"Invalid password"),null):(await (0,u.Vm)(a,e.email,n,"User not found"),null)}})],session:{strategy:"jwt",maxAge:86400,updateAge:300},jwt:{maxAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(e?.user&&(e.user.id=t?.id,e.user.role=t?.role),e)},pages:{signIn:"/giris"},secret:process.env.NEXTAUTH_SECRET,cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8412,7609,3390,1472,9521,3184],()=>r(79748));module.exports=s})();