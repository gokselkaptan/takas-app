"use strict";(()=>{var e={};e.id=4162,e.ids=[4162],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},3162:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>q});var o={};t.r(o),t.d(o,{DELETE:()=>x,GET:()=>w,POST:()=>f});var s=t(79182),n=t(72007),a=t(56719),l=t(93442),i=t(57978),u=t(11826),d=t(83178),p=t(58034),c=t(59628);async function w(e){try{let r=await (0,i.getServerSession)(u.L),t=r?.user?.id,{searchParams:o}=new URL(e.url),s=o.get("userId"),n=o.get("type"),a=s||t;if(!a)return l.NextResponse.json({error:"Kullanıcı ID gerekli"},{status:400});if("check"===n&&t){let e=await d.default.userFollow.findUnique({where:{followerId_followingId:{followerId:t,followingId:a}}});return l.NextResponse.json({isFollowing:!!e})}if("followers"===n){let e=await d.default.userFollow.findMany({where:{followingId:a},include:{follower:{select:{id:!0,name:!0,nickname:!0,image:!0,trustScore:!0,createdAt:!0}}},orderBy:{createdAt:"desc"}});return l.NextResponse.json(e.map(e=>({...e.follower,followedAt:e.createdAt})))}if("following"===n){let e=await d.default.userFollow.findMany({where:{followerId:a},include:{following:{select:{id:!0,name:!0,nickname:!0,image:!0,trustScore:!0,createdAt:!0}}},orderBy:{createdAt:"desc"}});return l.NextResponse.json(e.map(e=>({...e.following,followedAt:e.createdAt})))}let[p,c]=await Promise.all([d.default.userFollow.count({where:{followingId:a}}),d.default.userFollow.count({where:{followerId:a}})]);return l.NextResponse.json({followerCount:p,followingCount:c})}catch(e){return console.error("Follow GET error:",e),l.NextResponse.json({error:"Takip bilgisi alınamadı"},{status:500})}}async function f(e){try{let r=await (0,i.getServerSession)(u.L),t=r?.user?.id;if(!t)return l.NextResponse.json({error:"Giriş yapmalısınız"},{status:401});let{userId:o}=await e.json();if(!o)return l.NextResponse.json({error:"Kullanıcı ID gerekli"},{status:400});if(o===t)return l.NextResponse.json({error:"Kendinizi takip edemezsiniz"},{status:400});let s=await d.default.user.findUnique({where:{id:o},select:{id:!0,name:!0,nickname:!0}});if(!s)return l.NextResponse.json({error:"Kullanıcı bulunamadı"},{status:404});if(await d.default.userFollow.findUnique({where:{followerId_followingId:{followerId:t,followingId:o}}}))return l.NextResponse.json({error:"Zaten takip ediyorsunuz"},{status:400});await d.default.userFollow.create({data:{followerId:t,followingId:o}});let n=await d.default.userFollow.count({where:{followingId:o}}),a=await d.default.user.findUnique({where:{id:t},select:{name:!0,nickname:!0,email:!0}});return await d.default.activityFeed.create({data:{type:"followed_user",userId:t,userName:a?.name||a?.nickname||a?.email.split("@")[0],targetUserId:o,targetUserName:s.name||s.nickname||"Kullanıcı",visibility:"followers"}}),await (0,c.LX)(o,c.j_.SYSTEM,{title:"Yeni Takip\xe7i! \uD83C\uDF89",body:`${a?.name||a?.nickname||"Bir kullanıcı"} seni takip etmeye başladı`,data:{userId:t}}),await (0,p.ub)(t),await (0,p.ub)(o),l.NextResponse.json({success:!0,followerCount:n})}catch(e){return console.error("Follow POST error:",e),l.NextResponse.json({error:"Takip edilemedi"},{status:500})}}async function x(e){try{let r=await (0,i.getServerSession)(u.L),t=r?.user?.id;if(!t)return l.NextResponse.json({error:"Giriş yapmalısınız"},{status:401});let{searchParams:o}=new URL(e.url),s=o.get("userId");if(!s)return l.NextResponse.json({error:"Kullanıcı ID gerekli"},{status:400});await d.default.userFollow.deleteMany({where:{followerId:t,followingId:s}});let n=await d.default.userFollow.count({where:{followingId:s}});return l.NextResponse.json({success:!0,followerCount:n})}catch(e){return console.error("Follow DELETE error:",e),l.NextResponse.json({error:"Takipten \xe7ıkılamadı"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/follow/route",pathname:"/api/follow",filename:"route",bundlePath:"app/api/follow/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/follow/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:q,serverHooks:y}=m,h="/api/follow/route";function j(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:q})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[8412,7609,3390,1472,7853,9521,9628,4007],()=>t(3162));module.exports=o})();