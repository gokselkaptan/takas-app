"use strict";(()=>{var e={};e.id=2866,e.ids=[2866],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},82958:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>y,routeModule:()=>w,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var r={};a.r(r),a.d(r,{GET:()=>c,POST:()=>m,dynamic:()=>p});var s=a(79182),n=a(72007),i=a(56719),o=a(93442),d=a(57978),l=a(11826),u=a(37481);let p="force-dynamic";async function c(e){try{let t;let a=await (0,d.getServerSession)(l.L);if(!a?.user?.email)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url);return"true"===r.get("refresh")?t=await (0,u.kx)():(!(t=await (0,u.Tn)())||function(e){let t=new Date(e);return(new Date().getTime()-t.getTime())/36e5>24}(t.analyzedAt))&&(t=await (0,u.kx)()),o.NextResponse.json(t)}catch(e){return console.error("Demand analysis error:",e),o.NextResponse.json({error:"Talep analizi yapılamadı"},{status:500})}}async function m(e){try{let e=await (0,d.getServerSession)(l.L);if(!e?.user?.email)return o.NextResponse.json({error:"Unauthorized"},{status:401});let t=(await Promise.resolve().then(a.bind(a,83178))).default,r=await t.user.findUnique({where:{email:e.user.email},select:{role:!0}});if(r?.role!=="admin")return o.NextResponse.json({error:"Admin yetkisi gerekli"},{status:403});let s=await (0,u.kx)();return await (0,u.Oy)(s),o.NextResponse.json({success:!0,message:"Talep analizi g\xfcncellendi",analysis:s})}catch(e){return console.error("Demand analysis update error:",e),o.NextResponse.json({error:"Talep analizi g\xfcncellenemedi"},{status:500})}}let w=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/demand-analysis/route",pathname:"/api/admin/demand-analysis",filename:"route",bundlePath:"app/api/admin/demand-analysis/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/admin/demand-analysis/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:x}=w,h="/api/admin/demand-analysis/route";function f(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}},11826:(e,t,a)=>{a.d(t,{L:()=>l});var r=a(66291),s=a(64617),n=a(3390),i=a.n(n),o=a(83178),d=a(59521);let l={adapter:(0,s.N)(o.default),providers:[(0,r.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e,t){if(!e?.email||!e?.password)return null;let a=t?.headers?.["x-real-ip"],r=t?.headers?.["x-forwarded-for"],s=a?Array.isArray(a)?a[0]:a:r&&(Array.isArray(r)?r[0]:r).split(",").pop()?.trim()||"unknown",n=t?.headers?.["user-agent"]||"unknown";if(!(await (0,d.d5)(s,e.email)).allowed)throw await (0,d.Ky)(e.email,s,5,void 0),Error("ACCOUNT_LOCKED");let l=await o.default.user.findUnique({where:{email:e.email}});return l?await i().compare(e.password,l.password)?(await (0,d.LW)(s,l.id,l.email,n),await o.default.user.update({where:{id:l.id},data:{lastLoginAt:new Date}}),{id:l.id,email:l.email,name:l.name,role:l.role}):(await (0,d.Vm)(s,e.email,n,"Invalid password"),null):(await (0,d.Vm)(s,e.email,n,"User not found"),null)}})],session:{strategy:"jwt",maxAge:86400,updateAge:300},jwt:{maxAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(e?.user&&(e.user.id=t?.id,e.user.role=t?.role),e)},pages:{signIn:"/giris"},secret:process.env.NEXTAUTH_SECRET,cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}}},37481:(e,t,a)=>{a.d(t,{Oy:()=>n,Tn:()=>i,kx:()=>s});var r=a(83178);async function s(){let e=new Date;e.setDate(e.getDate()-7);let t=await r.default.category.findMany({include:{products:{where:{status:"active"},select:{id:!0,views:!0,createdAt:!0}}}}),a=await r.default.swapRequest.findMany({where:{status:"completed",updatedAt:{gte:e}},include:{product:{select:{categoryId:!0}}}}),s={};a.forEach(e=>{let t=e.product.categoryId;s[t]=(s[t]||0)+1});let n=0,i=0;t.forEach(e=>{e.products.forEach(e=>{n+=e.views,i++})});let o=i>0?n/i:0,d=a.length,l=t.map(e=>{let t=e.products.reduce((e,t)=>e+t.views,0),a=e.products.length,r=s[e.id]||0,n=a>0?t/a:0,i=50;o>0&&(i+=(n/o-1)*20),i+=30*(a>0?r/a:0),a<5&&t>2*o&&(i+=15);let d=1;d=(i=Math.max(0,Math.min(100,i)))<50?.8+i/50*.2:1+(i-50)/50*.3;let l="stable";return i>65?l="rising":i<35&&(l="falling"),{categoryId:e.id,categoryName:e.name,totalViews:t,totalProducts:a,completedSwaps:r,avgViewsPerProduct:n,demandScore:Math.round(i),priceMultiplier:Math.round(100*d)/100,trend:l}});return{analyzedAt:new Date,categories:l.sort((e,t)=>t.demandScore-e.demandScore),globalStats:{totalViews:n,totalSwaps:d,avgDemandScore:Math.round(l.reduce((e,t)=>e+t.demandScore,0)/l.length)}}}async function n(e){await r.default.systemMetrics.upsert({where:{id:"demand_analysis"},update:{data:JSON.stringify(e),lastUpdated:new Date},create:{id:"demand_analysis",data:JSON.stringify(e),lastUpdated:new Date}})}async function i(){let e=await r.default.systemMetrics.findUnique({where:{id:"demand_analysis"}});if(!e?.data)return null;try{return JSON.parse(e.data)}catch{return null}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8412,7609,3390,1472,9521],()=>a(82958));module.exports=r})();