"use strict";(()=>{var e={};e.id=3440,e.ids=[3440],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},12349:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>A,requestAsyncStorage:()=>f,routeModule:()=>w,serverHooks:()=>x,staticGenerationAsyncStorage:()=>y});var a={};t.r(a),t.d(a,{GET:()=>m,dynamic:()=>p});var s=t(79182),i=t(72007),n=t(56719),o=t(93442),u=t(57978),d=t(83178),l=t(11826);let p="force-dynamic";async function c(){let e=await (0,u.getServerSession)(l.L);if(!e?.user?.email)return null;let r=await d.default.user.findUnique({where:{email:e.user.email},select:{id:!0,role:!0,email:!0}});return r&&("admin"===r.role||"join@takas-a.com"===r.email)?r:null}async function m(e){let r=await c();if(!r)return o.NextResponse.json({error:"Yetkisiz"},{status:403});try{let{searchParams:t}=new URL(e.url),a=t.get("type")||"full",s={meta:{version:"1.0",date:new Date().toISOString(),type:a,platform:"TAKAS-A"}};return("full"===a||"users"===a)&&(s.users=await d.default.user.findMany({select:{id:!0,name:!0,email:!0,role:!0,valorBalance:!0,trustScore:!0,createdAt:!0}})),("full"===a||"products"===a)&&(s.products=await d.default.product.findMany({select:{id:!0,title:!0,description:!0,valorPrice:!0,condition:!0,images:!0,categoryId:!0,userId:!0,city:!0,status:!0,views:!0,createdAt:!0}})),("full"===a||"swaps"===a)&&(s.swapRequests=await d.default.swapRequest.findMany({select:{id:!0,requesterId:!0,ownerId:!0,productId:!0,offeredProductId:!0,pendingValorAmount:!0,status:!0,createdAt:!0,updatedAt:!0}})),("full"===a||"messages"===a)&&(s.messages=await d.default.message.findMany({select:{id:!0,senderId:!0,receiverId:!0,content:!0,productId:!0,isRead:!0,createdAt:!0},take:1e4,orderBy:{createdAt:"desc"}})),("full"===a||"valor"===a)&&(s.valorTransactions=await d.default.valorTransaction.findMany({select:{id:!0,fromUserId:!0,toUserId:!0,amount:!0,type:!0,description:!0,createdAt:!0},take:1e4,orderBy:{createdAt:"desc"}})),await d.default.errorLog.create({data:{type:"backup",message:`DB backup taken: ${a}`,severity:"info",userId:r.id,metadata:JSON.stringify({type:a,userCount:Array.isArray(s.users)?s.users.length:0,productCount:Array.isArray(s.products)?s.products.length:0,swapCount:Array.isArray(s.swapRequests)?s.swapRequests.length:0})}}),o.NextResponse.json(s)}catch(r){console.error("Backup error:",r);let e=r instanceof Error?r.message:"Bilinmeyen hata";return o.NextResponse.json({error:e},{status:500})}}let w=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/backup/route",pathname:"/api/admin/backup",filename:"route",bundlePath:"app/api/admin/backup/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/admin/backup/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:x}=w,g="/api/admin/backup/route";function A(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:y})}},11826:(e,r,t)=>{t.d(r,{L:()=>d});var a=t(66291),s=t(64617),i=t(3390),n=t.n(i),o=t(83178),u=t(59521);let d={adapter:(0,s.N)(o.default),providers:[(0,a.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e,r){if(!e?.email||!e?.password)return null;let t=r?.headers?.["x-real-ip"],a=r?.headers?.["x-forwarded-for"],s=t?Array.isArray(t)?t[0]:t:a&&(Array.isArray(a)?a[0]:a).split(",").pop()?.trim()||"unknown",i=r?.headers?.["user-agent"]||"unknown";if(!(await (0,u.d5)(s,e.email)).allowed)throw await (0,u.Ky)(e.email,s,5,void 0),Error("ACCOUNT_LOCKED");let d=await o.default.user.findUnique({where:{email:e.email}});return d?await n().compare(e.password,d.password)?(await (0,u.LW)(s,d.id,d.email,i),await o.default.user.update({where:{id:d.id},data:{lastLoginAt:new Date}}),{id:d.id,email:d.email,name:d.name,role:d.role}):(await (0,u.Vm)(s,e.email,i,"Invalid password"),null):(await (0,u.Vm)(s,e.email,i,"User not found"),null)}})],session:{strategy:"jwt",maxAge:86400,updateAge:300},jwt:{maxAge:86400},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.role=r.role),e),session:async({session:e,token:r})=>(e?.user&&(e.user.id=r?.id,e.user.role=r?.role),e)},pages:{signIn:"/giris"},secret:process.env.NEXTAUTH_SECRET,cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8412,7609,3390,1472,9521],()=>t(12349));module.exports=a})();