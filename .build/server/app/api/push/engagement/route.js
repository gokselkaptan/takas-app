"use strict";(()=>{var e={};e.id=6754,e.ids=[6754],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},7591:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>E,patchFetch:()=>w,requestAsyncStorage:()=>D,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var r={};a.r(r),a.d(r,{GET:()=>f,POST:()=>b,dynamic:()=>d});var n=a(79182),i=a(72007),o=a(56719),s=a(93442),l=a(83178),u=a(87853),c=a.n(u);let d="force-dynamic",p="BOlBaaC047bCq8RXHRkz7Eg3pp66EiiH5GgjYncOeWPhVwtPtE-fCMeguexDcpp3sdNC8XBdMP0CKyexg8kOA4w",y=process.env.VAPID_PRIVATE_KEY||"",m=process.env.NEXTAUTH_URL||"https://takas-a.com";p&&y&&c().setVapidDetails(m,p,y);let k=[{title:"Ayşe Teyze evini taşıyor! \uD83C\uDFE0",body:"Fazla eşyalarını takas yoluyla yeni sahiplerine ulaştırmak istiyor. Belki aradığın şey onda vardır!",url:"/urunler"},{title:"Fernando İzmir'e yeni taşındı! \uD83C\uDF1F",body:"Yatak odası takımı arıyor. Senin kullanmadığın mobilya onun hayalini ger\xe7ekleştirebilir!",url:"/urunler?category=mobilya"},{title:"Mehmet Bey garajını boşaltıyor! \uD83D\uDE97",body:"Yıllardır biriktirdiği spor ekipmanlarını takas etmek istiyor. Spor tutkunları i\xe7in ka\xe7ırılmayacak fırsat!",url:"/urunler?category=spor"},{title:"Zeynep bebek odası hazırlıyor! \uD83D\uDC76",body:"\xc7ocuk kıyafetleri ve oyuncaklar arıyor. \xc7ocuklarının eskidiği eşyalar yeni bir aileye umut olabilir!",url:"/urunler?category=bebek-cocuk"},{title:"Can evden \xe7alışmaya başladı! \uD83D\uDCBB",body:"Home office i\xe7in masa ve sandalye arıyor. Ofis eşyaların i\xe7in harika bir takas fırsatı!",url:"/urunler?category=mobilya"},{title:"Elif kitaplığını yeniliyor! \uD83D\uDCDA",body:"Okuduğu kitapları paylaşmak, yenilerini keşfetmek istiyor. Kitap severler i\xe7in m\xfckemmel fırsat!",url:"/urunler?category=kitap"},{title:"Bu hafta 47 takas tamamlandı! \uD83C\uDF89",body:"TAKAS-A topluluğu b\xfcy\xfcmeye devam ediyor. Sen de bu harekete katıl!",url:"/"},{title:"Yeni \xfcr\xfcnler eklendi! ✨",body:"Son 24 saatte 23 yeni \xfcr\xfcn listelendi. Belki aradığın şey yeni eklenenler arasındadır!",url:"/urunler?sort=newest"},{title:"Valor puanlarını kullan! \uD83D\uDC8E",body:"Hesabındaki Valor puanlarıyla takas işlemlerinde avantaj sağla. Kontrol etmeyi unutma!",url:"/profil"},{title:"Takas zincirleri oluşuyor! \uD83D\uDD17",body:"\xc7oklu takas fırsatları seni bekliyor. 3-5 kişilik zincirlerde herkes kazanıyor!",url:"/takas-firsatlari"},{title:"Kullanmadığın eşyalar değer kazansın! \uD83C\uDF31",body:"Evindeki kullanılmayan eşyalar başkası i\xe7in hazine olabilir. Hemen bir \xfcr\xfcn ekle!",url:"/urun-ekle"},{title:"S\xfcrd\xfcr\xfclebilir yaşam i\xe7in bir adım! \uD83C\uDF0D",body:"Her takas, daha az israf demek. Bug\xfcn sen de fark yarat!",url:"/"}];async function g(e){let t=await l.default.pushSubscription.findMany({where:{isActive:!0}}),a={sent:0,failed:0,deactivated:0};for(let r of t)try{await c().sendNotification({endpoint:r.endpoint,keys:{p256dh:r.p256dh,auth:r.auth}},JSON.stringify({title:e.title,body:e.body,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:e.url,tag:`engagement-${Date.now()}`})),a.sent++}catch(e){a.failed++,(404===e.statusCode||410===e.statusCode)&&(await l.default.pushSubscription.update({where:{id:r.id},data:{isActive:!1}}),a.deactivated++)}return a}async function b(e){try{let t=e.headers.get("authorization"),a=process.env.ENGAGEMENT_NOTIFICATION_KEY||"takas-a-engagement-2024";if(t!==`Bearer ${a}`)return s.NextResponse.json({error:"Unauthorized"},{status:401});let r=(await e.json().catch(()=>({}))).template||function(){let e=Math.floor(Math.random()*k.length);return k[e]}(),n=await g(r);return console.log("Engagement notifications sent:",n),s.NextResponse.json({success:!0,template:r.title,results:n})}catch(e){return console.error("Engagement notification error:",e),s.NextResponse.json({error:"Failed to send notifications"},{status:500})}}async function f(){return s.NextResponse.json({templates:k,count:k.length})}let h=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/push/engagement/route",pathname:"/api/push/engagement",filename:"route",bundlePath:"app/api/push/engagement/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/push/engagement/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:D,staticGenerationAsyncStorage:v,serverHooks:x}=h,E="/api/push/engagement/route";function w(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}},83178:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var r=a(53524);let n=globalThis,i="phase-production-build"===process.env.NEXT_PHASE||!0,o=n.prisma??(()=>{let e=new r.PrismaClient({log:["error"],datasources:{db:{url:function(){let e=process.env.DATABASE_URL||"";if(e.includes("connection_limit")||e.includes("pool_timeout"))return e;let t=e.includes("?")?"&":"?";return`${e}${t}connection_limit=${i?1:10}&pool_timeout=${i?60:20}&connect_timeout=10&socket_timeout=20&pgbouncer=true&statement_cache_size=0`}()}}});return e.$use(async(t,a)=>{let r=0;for(;r<=5;)try{let e=await a(t);return n.lastConnectTime=Date.now(),e}catch(a){let t=a instanceof Error?a.message:String(a);if((t.includes("idle-session timeout")||t.includes("terminating connection")||t.includes("ECONNRESET")||t.includes("Connection refused")||t.includes("connection closed")||t.includes("socket")||t.includes("ETIMEDOUT")||t.includes("connection timed out")||t.includes("prepared statement"))&&r<5){if(r++,console.log(`[Prisma] Connection error, retry ${r}/5: ${t.substring(0,100)}`),r>=2)try{await e.$disconnect(),await e.$connect(),console.log("[Prisma] Reconnected successfully")}catch{}await new Promise(e=>setTimeout(e,100*Math.pow(2,r-1)));continue}throw a}}),e})();n.prisma=o,"undefined"!=typeof process&&process.on("beforeExit",async()=>{await o.$disconnect()});let s=null;"undefined"==typeof process||i||!s&&(i||(s=setInterval(async()=>{try{await o.$queryRaw`SELECT 1`}catch(e){console.warn("[Prisma KeepAlive] Bağlantı hatası, yeniden bağlanılıyor:",e.message?.substring(0,80));try{await o.$connect(),console.log("[Prisma KeepAlive] Yeniden bağlantı başarılı")}catch(e){console.error("[Prisma KeepAlive] Yeniden bağlantı başarısız!")}}},12e4)).unref());let l=o}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8412,7609,7853],()=>a(7591));module.exports=r})();