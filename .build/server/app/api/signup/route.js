"use strict";(()=>{var e={};e.id=5409,e.ids=[5409],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},87890:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>k,routeModule:()=>x,serverHooks:()=>y,staticGenerationAsyncStorage:()=>b});var i={};t.r(i),t.d(i,{POST:()=>f,dynamic:()=>g});var n=t(79182),r=t(72007),o=t(56719),s=t(93442),l=t(3390),u=t.n(l),d=t(83178),p=t(59521),m=t(85698),c=t(81510);let g="force-dynamic";function w(){return Math.floor(1e5+9e5*Math.random()).toString()}async function z(e,a,t){process.env.NEXTAUTH_URL;let i=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; background: #f8fafc; padding: 40px 20px;">
      <div style="background: white; border-radius: 16px; padding: 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <div style="text-align: center; margin-bottom: 30px;">
          <h1 style="color: #7c3aed; margin: 0; font-size: 28px;">TAKAS-A</h1>
          <p style="color: #64748b; margin-top: 8px;">Email Doğrulama</p>
        </div>
        
        <p style="color: #334155; font-size: 16px;">Merhaba ${t||"Kullanıcı"},</p>
        
        <p style="color: #475569; font-size: 15px; line-height: 1.6;">
          TAKAS-A'ya hoş geldiniz! Hesabınızı aktif hale getirmek i\xe7in aşağıdaki doğrulama kodunu kullanın:
        </p>
        
        <div style="background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%); border-radius: 12px; padding: 24px; text-align: center; margin: 30px 0;">
          <span style="color: white; font-size: 36px; font-weight: bold; letter-spacing: 8px;">${a}</span>
        </div>
        
        <p style="color: #64748b; font-size: 14px; text-align: center;">
          Bu kod <strong>10 dakika</strong> i\xe7inde ge\xe7erliliğini yitirecektir.
        </p>
        
        <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 30px 0;" />
        
        <p style="color: #94a3b8; font-size: 12px; text-align: center;">
          Bu emaili siz talep etmediyseniz, l\xfctfen dikkate almayın.
        </p>
      </div>
    </div>
  `;try{let t=await fetch("https://apps.abacus.ai/api/sendNotificationEmail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deployment_token:process.env.ABACUSAI_API_KEY,app_id:process.env.WEB_APP_ID,notification_id:process.env.NOTIF_ID_EMAIL_DORULAMA_KODU,subject:`TAKAS-A Email Doğrulama Kodunuz: ${a}`,body:i,is_html:!0,recipient_email:e,sender_email:"noreply@takas-a.com",sender_alias:"TAKAS-A"})});return(await t.json()).success}catch(e){return console.error("Email send error:",e),!1}}async function f(e){try{let a=(0,p.H9)(e),t=(0,p.ij)(e);if(!(await (0,m.Dn)(a,"api/signup")).allowed)return s.NextResponse.json({error:"\xc7ok fazla kayıt denemesi. L\xfctfen 1 saat sonra tekrar deneyin."},{status:429});if((await (0,p.n$)(a)).blocked)return s.NextResponse.json({error:"Erişim engellendi"},{status:403});let i=await e.json(),{success:n,data:r,error:o}=(0,c.Gu)(c.if,i);if(!n||!r)return s.NextResponse.json({error:o||"Ge\xe7ersiz veri"},{status:400});let{email:l,password:g,name:f,nickname:x}=r,k={website:i?.website,company:i?.company,faxNumber:i?.faxNumber};if((await (0,p.et)(a,"/api/signup",k,t)).isBot)return s.NextResponse.json({error:"Kayıt sırasında bir hata oluştu"},{status:400});let b=await d.default.user.findUnique({where:{email:l}});if(b){if(!b.emailVerified){let e=w(),a=new Date(Date.now()+6e5);await d.default.user.update({where:{email:l},data:{verificationCode:e,verificationCodeExpiry:a,password:await u().hash(g,12),name:f??b.name,nickname:x??b.nickname}});let t=await z(l,e,f||b.name||"");return s.NextResponse.json({requiresVerification:!0,email:l,message:t?"Doğrulama kodu emailinize g\xf6nderildi":"Doğrulama kodu g\xf6nderilemedi, l\xfctfen tekrar deneyin"})}return s.NextResponse.json({error:"Bu email zaten kayıtlı"},{status:400})}let y=await u().hash(g,12),h=w(),v=new Date(Date.now()+6e5),M=await d.default.user.create({data:{email:l,password:y,name:f??"",nickname:x||null,verificationCode:h,verificationCodeExpiry:v}}),A=await z(l,h,f||"");return s.NextResponse.json({requiresVerification:!0,email:M.email,message:A?"Doğrulama kodu emailinize g\xf6nderildi":"Doğrulama kodu g\xf6nderilemedi, l\xfctfen tekrar deneyin"})}catch(e){return console.error("Signup error:",e),s.NextResponse.json({error:"Kayıt sırasında bir hata oluştu"},{status:500})}}let x=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/signup/route",pathname:"/api/signup",filename:"route",bundlePath:"app/api/signup/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/signup/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:k,staticGenerationAsyncStorage:b,serverHooks:y}=x,h="/api/signup/route";function v(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:b})}},85698:(e,a,t)=>{t.d(a,{Dn:()=>o,s$:()=>s});var i=t(83178),n=t(59521);let r={"api/products":{windowMs:6e4,maxRequests:100},"api/favorites":{windowMs:6e4,maxRequests:60},"api/messages":{windowMs:6e4,maxRequests:30},"api/signup":{windowMs:36e5,maxRequests:5},"api/swap-requests":{windowMs:6e4,maxRequests:20},"api/services":{windowMs:6e4,maxRequests:30},"api/wishboard":{windowMs:6e4,maxRequests:20},"api/profile/photo":{windowMs:3e5,maxRequests:10},"api/admin/backup":{windowMs:36e5,maxRequests:3},"api/auth/two-factor":{windowMs:3e5,maxRequests:5},"api/valor/calculate":{windowMs:6e4,maxRequests:5},"api/ai-visualize":{windowMs:6e4,maxRequests:5},"api/visual-search":{windowMs:6e4,maxRequests:5},"api/ai-moderation":{windowMs:6e4,maxRequests:10},"api/ai-translate":{windowMs:6e4,maxRequests:10},default:{windowMs:6e4,maxRequests:100}};async function o(e,a){if(["join@takas-a.com"].includes(e))return{allowed:!0,remaining:999,resetAt:new Date(Date.now()+6e4)};let t=r[a]||r.default,n=new Date,o=new Date(n.getTime()-t.windowMs);try{let r=await i.default.rateLimit.findUnique({where:{identifier_endpoint:{identifier:e,endpoint:a}}});if(!r)return await i.default.rateLimit.create({data:{identifier:e,endpoint:a,count:1,windowStart:n}}),{allowed:!0,remaining:t.maxRequests-1,resetAt:new Date(n.getTime()+t.windowMs)};if(r.windowStart<o)return await i.default.rateLimit.update({where:{id:r.id},data:{count:1,windowStart:n}}),{allowed:!0,remaining:t.maxRequests-1,resetAt:new Date(n.getTime()+t.windowMs)};if(r.count>=t.maxRequests){let e=new Date(r.windowStart.getTime()+t.windowMs);return{allowed:!1,remaining:0,resetAt:e}}return await i.default.rateLimit.update({where:{id:r.id},data:{count:r.count+1}}),{allowed:!0,remaining:t.maxRequests-r.count-1,resetAt:new Date(r.windowStart.getTime()+t.windowMs)}}catch(e){return console.error("Rate limit check error:",e),{allowed:!1,remaining:0,resetAt:new Date(n.getTime()+t.windowMs)}}}function s(e){return(0,n.H9)(e)}},81510:(e,a,t)=>{t.d(a,{C$:()=>r,Gu:()=>u,QT:()=>l,if:()=>p,lw:()=>s,qi:()=>o,td:()=>n});var i=t(91209);let n=i.z.object({title:i.z.string().min(3,"Başlık en az 3 karakter").max(200,"Başlık en fazla 200 karakter").trim(),description:i.z.string().min(10,"A\xe7ıklama en az 10 karakter").max(5e3).trim(),valorPrice:i.z.number().int().min(1,"Değer en az 1 Valor").max(1e5,"Değer en fazla 100000 Valor"),condition:i.z.enum(["new","like_new","good","fair","poor"]).default("good"),categoryId:i.z.string().min(1,"Kategori se\xe7iniz"),city:i.z.string().default("İzmir"),district:i.z.string().optional(),images:i.z.array(i.z.string()).max(10,"En fazla 10 g\xf6rsel").optional(),latitude:i.z.number().optional(),longitude:i.z.number().optional(),usageInfo:i.z.string().optional(),checklistData:i.z.string().optional(),userValorPrice:i.z.number().optional(),acceptsNegotiation:i.z.boolean().optional(),isFreeAvailable:i.z.boolean().optional()}),r=i.z.object({productId:i.z.string().min(1,"\xdcr\xfcn ID gerekli"),message:i.z.string().max(1e3,"Mesaj en fazla 1000 karakter").optional(),offeredProductId:i.z.string().nullable().optional(),offeredValor:i.z.number().int().min(0).max(1e5).optional(),quickOffer:i.z.boolean().optional(),smartMatch:i.z.boolean().optional()}),o=i.z.object({receiverId:i.z.string().min(1,"Alıcı ID gerekli"),content:i.z.string().min(1,"Mesaj boş olamaz").max(5e3,"Mesaj en fazla 5000 karakter").trim(),productId:i.z.string().optional(),image:i.z.string().optional()});i.z.object({name:i.z.string().min(2,"İsim en az 2 karakter").max(100).trim().optional(),phone:i.z.string().regex(/^(\+90|0)?[0-9]{10}$/,"Ge\xe7ersiz telefon numarası").optional().nullable(),city:i.z.string().max(100).optional(),district:i.z.string().max(100).optional(),bio:i.z.string().max(500).optional()});let s=i.z.object({title:i.z.string().min(3,"Başlık en az 3 karakter").max(200).trim(),description:i.z.string().min(10,"A\xe7ıklama en az 10 karakter").max(5e3).trim(),category:i.z.enum(["cleaning","electrical","plumbing","beauty","education","cooking","repair","delivery","design","photography","other"]),duration:i.z.string().max(50),valorPrice:i.z.number().int().min(1,"Değer en az 1 Valor").max(1e5),city:i.z.string().default("İzmir"),district:i.z.string().optional(),serviceArea:i.z.string().optional(),wantCategory:i.z.string().optional(),wantDescription:i.z.string().max(500).optional(),listingType:i.z.enum(["individual","business"]).default("individual"),businessName:i.z.string().max(200).optional(),businessType:i.z.string().optional(),unitType:i.z.string().optional(),unitCount:i.z.number().int().optional(),images:i.z.array(i.z.string()).optional()}),l=i.z.object({wantTitle:i.z.string().min(3,"Başlık en az 3 karakter").max(200).trim(),wantDescription:i.z.string().max(2e3).optional(),wantCategory:i.z.string().min(1,"Kategori gerekli"),wantMinValue:i.z.number().int().min(0).optional(),wantMaxValue:i.z.number().int().max(1e5).optional(),offerType:i.z.enum(["specific_product","category","any"]).default("any"),preferredCity:i.z.string().optional(),isUrgent:i.z.boolean().default(!1),offerProductId:i.z.string().optional(),offerCategory:i.z.string().optional(),offerTitle:i.z.string().optional(),offerDescription:i.z.string().optional(),offerMinValue:i.z.number().optional(),offerMaxValue:i.z.number().optional(),deadline:i.z.string().optional(),urgencyBonus:i.z.number().optional()});function u(e,a){try{let t=e.parse(a);return{success:!0,data:t}}catch(e){if(e instanceof i.z.ZodError)return{success:!1,error:e.errors.map(e=>e.message).join(", ")};return{success:!1,error:"Ge\xe7ersiz veri"}}}let d=i.z.string().min(8,"Şifre en az 8 karakter olmalı").max(128,"Şifre en fazla 128 karakter olabilir").refine(e=>/[A-Z]/.test(e),"En az 1 b\xfcy\xfck harf gerekli").refine(e=>/[a-z]/.test(e),"En az 1 k\xfc\xe7\xfck harf gerekli").refine(e=>/[0-9]/.test(e),"En az 1 rakam gerekli"),p=i.z.object({email:i.z.string().email("Ge\xe7erli bir e-posta girin").trim().toLowerCase(),password:d,name:i.z.string().min(2,"İsim en az 2 karakter").max(100).trim(),nickname:i.z.string().min(2).max(50).trim().optional()});i.z.object({currentPassword:i.z.string().min(1,"Mevcut şifre gerekli"),newPassword:d})}};var a=require("../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),i=a.X(0,[8412,7609,3390,1209,9521],()=>t(87890));module.exports=i})();