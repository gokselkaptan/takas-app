"use strict";(()=>{var e={};e.id=84,e.ids=[84],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},35578:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>x,serverHooks:()=>k,staticGenerationAsyncStorage:()=>v});var i={};r.r(i),r.d(i,{GET:()=>w,POST:()=>f,PUT:()=>z,dynamic:()=>g});var a=r(79182),n=r(72007),s=r(56719),o=r(93442),l=r(57978),u=r(83178),d=r(11826),c=r(81510),p=r(92054),m=r(85698);let g="force-dynamic";async function w(e){try{let{searchParams:t}=new URL(e.url),r=t.get("category"),i=t.get("city"),a=t.get("type"),n=t.get("my"),s=parseInt(t.get("limit")||"20"),c=t.get("id");if(c){let e=await u.default.serviceListing.findUnique({where:{id:c},include:{user:{select:{id:!0,name:!0,image:!0,trustScore:!0}}}});if(!e)return o.NextResponse.json({error:"Hizmet bulunamadı"},{status:404});return await u.default.serviceListing.update({where:{id:c},data:{views:{increment:1}}}),o.NextResponse.json({service:e})}if("true"===n){let e=await (0,l.getServerSession)(d.L);if(!e?.user?.email)return o.NextResponse.json({error:"Giriş yapınız"},{status:401});let t=await u.default.user.findUnique({where:{email:e.user.email}});if(!t)return o.NextResponse.json({error:"Kullanıcı bulunamadı"},{status:404});let r=await u.default.serviceListing.findMany({where:{userId:t.id},orderBy:{createdAt:"desc"},include:{user:{select:{id:!0,name:!0,image:!0}}}});return o.NextResponse.json({services:r})}let p={status:"active"};r&&"all"!==r&&(p.category=r),i&&"all"!==i&&(p.city=i),a&&"all"!==a&&(p.listingType=a);let m=await u.default.serviceListing.findMany({where:p,orderBy:{createdAt:"desc"},take:s,include:{user:{select:{id:!0,name:!0,image:!0,trustScore:!0}}}}),g=await u.default.serviceListing.count({where:p}),w=await u.default.serviceListing.groupBy({by:["category"],where:{status:"active"},_count:!0});return o.NextResponse.json({services:m,total:g,stats:w})}catch(e){return console.error("Services GET error:",e),o.NextResponse.json({error:"Sunucu hatası"},{status:500})}}async function f(e){try{let t=e.headers.get("x-forwarded-for")?.split(",")[0]?.trim()||"unknown";if(!(await (0,m.Dn)(t,"api/services")).allowed)return o.NextResponse.json({error:"\xc7ok fazla istek. L\xfctfen biraz bekleyin."},{status:429});let r=await (0,l.getServerSession)(d.L);if(!r?.user?.email)return o.NextResponse.json({error:"Giriş yapınız"},{status:401});let i=await u.default.user.findUnique({where:{email:r.user.email}});if(!i)return o.NextResponse.json({error:"Kullanıcı bulunamadı"},{status:404});let a=await e.json(),{success:n,error:s}=(0,c.Gu)(c.lw,{...a,valorPrice:Number(a.valorPrice)||a.valorPrice});if(!n)return o.NextResponse.json({error:s},{status:400});if(!a.title||!a.category||!a.valorPrice)return o.NextResponse.json({error:"Başlık, kategori ve değer zorunludur"},{status:400});let g=(0,p.oO)(a.title),w=(0,p.oO)(a.description||""),f=await u.default.serviceListing.create({data:{userId:i.id,title:g,description:w,category:a.category,duration:a.duration||"1 saat",unitType:a.unitType||"hour",unitCount:a.unitCount||1,valorPrice:parseInt(a.valorPrice),city:a.city||"İzmir",district:a.district,serviceArea:a.serviceArea,wantCategory:a.wantCategory,wantDescription:a.wantDescription?.trim(),listingType:a.listingType||"individual",businessName:a.businessName?.trim(),businessType:a.businessType,images:a.images||[]}});return o.NextResponse.json({success:!0,service:f})}catch(e){return console.error("Services POST error:",e),o.NextResponse.json({error:"Sunucu hatası"},{status:500})}}async function z(e){try{let t=await (0,l.getServerSession)(d.L);if(!t?.user?.email)return o.NextResponse.json({error:"Giriş yapınız"},{status:401});let r=await u.default.user.findUnique({where:{email:t.user.email}});if(!r)return o.NextResponse.json({error:"Kullanıcı bulunamadı"},{status:404});let i=await e.json();if("delete"===i.action)return await u.default.serviceListing.deleteMany({where:{id:i.id,userId:r.id}}),o.NextResponse.json({success:!0});if("toggleStatus"===i.action){let e=await u.default.serviceListing.findFirst({where:{id:i.id,userId:r.id}});if(!e)return o.NextResponse.json({error:"Hizmet bulunamadı"},{status:404});return await u.default.serviceListing.update({where:{id:i.id},data:{status:"active"===e.status?"paused":"active"}}),o.NextResponse.json({success:!0})}let a={};return i.title&&(a.title=i.title.trim()),void 0!==i.description&&(a.description=i.description.trim()),i.valorPrice&&(a.valorPrice=parseInt(i.valorPrice)),void 0!==i.wantDescription&&(a.wantDescription=i.wantDescription.trim()),i.status&&(a.status=i.status),i.duration&&(a.duration=i.duration),void 0!==i.serviceArea&&(a.serviceArea=i.serviceArea),i.category&&(a.category=i.category),await u.default.serviceListing.update({where:{id:i.id},data:a}),o.NextResponse.json({success:!0})}catch(e){return console.error("Services PUT error:",e),o.NextResponse.json({error:"Sunucu hatası"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/services/route",pathname:"/api/services",filename:"route",bundlePath:"app/api/services/route"},resolvedPagePath:"/home/ubuntu/takas-a-kodlar/nextjs_space/app/api/services/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:v,serverHooks:k}=x,b="/api/services/route";function h(){return(0,s.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:v})}},11826:(e,t,r)=>{r.d(t,{L:()=>u});var i=r(66291),a=r(64617),n=r(3390),s=r.n(n),o=r(83178),l=r(59521);let u={adapter:(0,a.N)(o.default),providers:[(0,i.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e,t){if(!e?.email||!e?.password)return null;let r=t?.headers?.["x-real-ip"],i=t?.headers?.["x-forwarded-for"],a=r?Array.isArray(r)?r[0]:r:i&&(Array.isArray(i)?i[0]:i).split(",").pop()?.trim()||"unknown",n=t?.headers?.["user-agent"]||"unknown";if(!(await (0,l.d5)(a,e.email)).allowed)throw await (0,l.Ky)(e.email,a,5,void 0),Error("ACCOUNT_LOCKED");let u=await o.default.user.findUnique({where:{email:e.email}});return u?await s().compare(e.password,u.password)?(await (0,l.LW)(a,u.id,u.email,n),await o.default.user.update({where:{id:u.id},data:{lastLoginAt:new Date}}),{id:u.id,email:u.email,name:u.name,role:u.role}):(await (0,l.Vm)(a,e.email,n,"Invalid password"),null):(await (0,l.Vm)(a,e.email,n,"User not found"),null)}})],session:{strategy:"jwt",maxAge:86400,updateAge:300},jwt:{maxAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(e?.user&&(e.user.id=t?.id,e.user.role=t?.role),e)},pages:{signIn:"/giris"},secret:process.env.NEXTAUTH_SECRET,cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}}},85698:(e,t,r)=>{r.d(t,{Dn:()=>s,s$:()=>o});var i=r(83178),a=r(59521);let n={"api/products":{windowMs:6e4,maxRequests:100},"api/favorites":{windowMs:6e4,maxRequests:60},"api/messages":{windowMs:6e4,maxRequests:30},"api/signup":{windowMs:36e5,maxRequests:5},"api/swap-requests":{windowMs:6e4,maxRequests:20},"api/services":{windowMs:6e4,maxRequests:30},"api/wishboard":{windowMs:6e4,maxRequests:20},"api/profile/photo":{windowMs:3e5,maxRequests:10},"api/admin/backup":{windowMs:36e5,maxRequests:3},"api/auth/two-factor":{windowMs:3e5,maxRequests:5},"api/valor/calculate":{windowMs:6e4,maxRequests:5},"api/ai-visualize":{windowMs:6e4,maxRequests:5},"api/visual-search":{windowMs:6e4,maxRequests:5},"api/ai-moderation":{windowMs:6e4,maxRequests:10},"api/ai-translate":{windowMs:6e4,maxRequests:10},default:{windowMs:6e4,maxRequests:100}};async function s(e,t){if(["join@takas-a.com"].includes(e))return{allowed:!0,remaining:999,resetAt:new Date(Date.now()+6e4)};let r=n[t]||n.default,a=new Date,s=new Date(a.getTime()-r.windowMs);try{let n=await i.default.rateLimit.findUnique({where:{identifier_endpoint:{identifier:e,endpoint:t}}});if(!n)return await i.default.rateLimit.create({data:{identifier:e,endpoint:t,count:1,windowStart:a}}),{allowed:!0,remaining:r.maxRequests-1,resetAt:new Date(a.getTime()+r.windowMs)};if(n.windowStart<s)return await i.default.rateLimit.update({where:{id:n.id},data:{count:1,windowStart:a}}),{allowed:!0,remaining:r.maxRequests-1,resetAt:new Date(a.getTime()+r.windowMs)};if(n.count>=r.maxRequests){let e=new Date(n.windowStart.getTime()+r.windowMs);return{allowed:!1,remaining:0,resetAt:e}}return await i.default.rateLimit.update({where:{id:n.id},data:{count:n.count+1}}),{allowed:!0,remaining:r.maxRequests-n.count-1,resetAt:new Date(n.windowStart.getTime()+r.windowMs)}}catch(e){return console.error("Rate limit check error:",e),{allowed:!1,remaining:0,resetAt:new Date(a.getTime()+r.windowMs)}}}function o(e){return(0,a.H9)(e)}},92054:(e,t,r)=>{r.d(t,{oO:()=>i});function i(e){return e&&"string"==typeof e?e.trim().replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript\s*:/gi,"").replace(/data\s*:\s*text\/html/gi,"").replace(/<iframe/gi,"&lt;iframe").replace(/<object/gi,"&lt;object").replace(/<embed/gi,"&lt;embed").replace(/<form/gi,"&lt;form"):""}},81510:(e,t,r)=>{r.d(t,{C$:()=>n,Gu:()=>u,QT:()=>l,if:()=>c,lw:()=>o,qi:()=>s,td:()=>a});var i=r(91209);let a=i.z.object({title:i.z.string().min(3,"Başlık en az 3 karakter").max(200,"Başlık en fazla 200 karakter").trim(),description:i.z.string().min(10,"A\xe7ıklama en az 10 karakter").max(5e3).trim(),valorPrice:i.z.number().int().min(1,"Değer en az 1 Valor").max(1e5,"Değer en fazla 100000 Valor"),condition:i.z.enum(["new","like_new","good","fair","poor"]).default("good"),categoryId:i.z.string().min(1,"Kategori se\xe7iniz"),city:i.z.string().default("İzmir"),district:i.z.string().optional(),images:i.z.array(i.z.string()).max(10,"En fazla 10 g\xf6rsel").optional(),latitude:i.z.number().optional(),longitude:i.z.number().optional(),usageInfo:i.z.string().optional(),checklistData:i.z.string().optional(),userValorPrice:i.z.number().optional(),acceptsNegotiation:i.z.boolean().optional(),isFreeAvailable:i.z.boolean().optional()}),n=i.z.object({productId:i.z.string().min(1,"\xdcr\xfcn ID gerekli"),message:i.z.string().max(1e3,"Mesaj en fazla 1000 karakter").optional(),offeredProductId:i.z.string().nullable().optional(),offeredValor:i.z.number().int().min(0).max(1e5).optional(),quickOffer:i.z.boolean().optional(),smartMatch:i.z.boolean().optional()}),s=i.z.object({receiverId:i.z.string().min(1,"Alıcı ID gerekli"),content:i.z.string().min(1,"Mesaj boş olamaz").max(5e3,"Mesaj en fazla 5000 karakter").trim(),productId:i.z.string().optional(),image:i.z.string().optional()});i.z.object({name:i.z.string().min(2,"İsim en az 2 karakter").max(100).trim().optional(),phone:i.z.string().regex(/^(\+90|0)?[0-9]{10}$/,"Ge\xe7ersiz telefon numarası").optional().nullable(),city:i.z.string().max(100).optional(),district:i.z.string().max(100).optional(),bio:i.z.string().max(500).optional()});let o=i.z.object({title:i.z.string().min(3,"Başlık en az 3 karakter").max(200).trim(),description:i.z.string().min(10,"A\xe7ıklama en az 10 karakter").max(5e3).trim(),category:i.z.enum(["cleaning","electrical","plumbing","beauty","education","cooking","repair","delivery","design","photography","other"]),duration:i.z.string().max(50),valorPrice:i.z.number().int().min(1,"Değer en az 1 Valor").max(1e5),city:i.z.string().default("İzmir"),district:i.z.string().optional(),serviceArea:i.z.string().optional(),wantCategory:i.z.string().optional(),wantDescription:i.z.string().max(500).optional(),listingType:i.z.enum(["individual","business"]).default("individual"),businessName:i.z.string().max(200).optional(),businessType:i.z.string().optional(),unitType:i.z.string().optional(),unitCount:i.z.number().int().optional(),images:i.z.array(i.z.string()).optional()}),l=i.z.object({wantTitle:i.z.string().min(3,"Başlık en az 3 karakter").max(200).trim(),wantDescription:i.z.string().max(2e3).optional(),wantCategory:i.z.string().min(1,"Kategori gerekli"),wantMinValue:i.z.number().int().min(0).optional(),wantMaxValue:i.z.number().int().max(1e5).optional(),offerType:i.z.enum(["specific_product","category","any"]).default("any"),preferredCity:i.z.string().optional(),isUrgent:i.z.boolean().default(!1),offerProductId:i.z.string().optional(),offerCategory:i.z.string().optional(),offerTitle:i.z.string().optional(),offerDescription:i.z.string().optional(),offerMinValue:i.z.number().optional(),offerMaxValue:i.z.number().optional(),deadline:i.z.string().optional(),urgencyBonus:i.z.number().optional()});function u(e,t){try{let r=e.parse(t);return{success:!0,data:r}}catch(e){if(e instanceof i.z.ZodError)return{success:!1,error:e.errors.map(e=>e.message).join(", ")};return{success:!1,error:"Ge\xe7ersiz veri"}}}let d=i.z.string().min(8,"Şifre en az 8 karakter olmalı").max(128,"Şifre en fazla 128 karakter olabilir").refine(e=>/[A-Z]/.test(e),"En az 1 b\xfcy\xfck harf gerekli").refine(e=>/[a-z]/.test(e),"En az 1 k\xfc\xe7\xfck harf gerekli").refine(e=>/[0-9]/.test(e),"En az 1 rakam gerekli"),c=i.z.object({email:i.z.string().email("Ge\xe7erli bir e-posta girin").trim().toLowerCase(),password:d,name:i.z.string().min(2,"İsim en az 2 karakter").max(100).trim(),nickname:i.z.string().min(2).max(50).trim().optional()});i.z.object({currentPassword:i.z.string().min(1,"Mevcut şifre gerekli"),newPassword:d})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8412,7609,3390,1472,1209,9521],()=>r(35578));module.exports=i})();