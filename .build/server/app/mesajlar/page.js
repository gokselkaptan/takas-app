(()=>{var e={};e.id=2084,e.ids=[2084],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30399:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>o}),a(87189),a(32314),a(9126),a(84131),a(24450);var r=a(36576),s=a(72007),i=a(21818),n=a.n(i),l=a(88897),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);a.d(t,d);let o=["",{children:["mesajlar",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,87189)),"/home/ubuntu/takas-a-kodlar/nextjs_space/app/mesajlar/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,32314)),"/home/ubuntu/takas-a-kodlar/nextjs_space/app/layout.tsx"],error:[()=>Promise.resolve().then(a.bind(a,9126)),"/home/ubuntu/takas-a-kodlar/nextjs_space/app/error.tsx"],loading:[()=>Promise.resolve().then(a.bind(a,84131)),"/home/ubuntu/takas-a-kodlar/nextjs_space/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,24450)),"/home/ubuntu/takas-a-kodlar/nextjs_space/app/not-found.tsx"]}],c=["/home/ubuntu/takas-a-kodlar/nextjs_space/app/mesajlar/page.tsx"],u="/mesajlar/page",m={require:a,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/mesajlar/page",pathname:"/mesajlar",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},97803:(e,t,a)=>{Promise.resolve().then(a.bind(a,75180))},75180:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var r=a(62901),s=a(24383),i=a(84700),n=a(84374),l=a(75115),d=a(62392),o=a(13943),c=a(80412),u=a(10333),m=a(16501),x=a(83545),h=a(77185),p=a(71028),g=a(75909),y=a(26482),f=a(21680),b=a(48015),j=a(40140),k=a(89404),v=a(54936);function N(){let{data:e,status:t}=(0,i.useSession)(),a=(0,n.useRouter)();(0,n.useSearchParams)();let{t:N}=(0,v.Z)(),[w,E]=(0,s.useState)([]),[T,C]=(0,s.useState)(null),[U,O]=(0,s.useState)([]),[R,S]=(0,s.useState)(""),[_,M]=(0,s.useState)(!0),[P,Z]=(0,s.useState)(!1),[D,I]=(0,s.useState)(!1),[A,$]=(0,s.useState)(null),[L,z]=(0,s.useState)(!1),[G,q]=(0,s.useState)(null),[V,B]=(0,s.useState)(!1),K=(0,s.useRef)(null),H=(0,s.useRef)(0),J=e?.user?.email==="join@takas-a.com",F=async()=>{if((0,j.s9)()){$("İnternet bağlantınız yok"),M(!1);return}M(!0),$(null);try{let{data:e,ok:t,error:r,status:s}=await (0,j.DV)("/api/messages",{timeout:15e3});if(t&&e){let t=e.conversations||e||[],a=Array.isArray(t)?t:[],r=a.reduce((e,t)=>e+(t.unreadCount||0),0);r>H.current&&H.current>0&&(0,k.hh)(),H.current=r,E(a)}else 401===s?a.replace("/giris"):$(r||"Konuşmalar y\xfcklenemedi")}catch(e){$(e.message||"Beklenmeyen hata")}finally{M(!1)}},W=async(e,t)=>{if(!(0,j.s9)()){Z(!0);try{let a=new URLSearchParams({otherUserId:e});t&&a.append("productId",t);let{data:r,ok:s}=await (0,j.DV)(`/api/messages?${a}`,{timeout:12e3});s&&r&&O(r.messages||[])}catch(e){console.error("Mesajlar y\xfcklenemedi:",e)}finally{Z(!1)}}},X=e=>{C(e),W(e.otherUser.id,e.product?.id)},Q=async e=>{if(e.preventDefault(),R.trim()&&T){if((0,j.s9)()){$("İnternet bağlantınız yok");return}I(!0);try{let{data:e,ok:t,error:a}=await (0,j.Pe)("/api/messages",{receiverId:T.otherUser.id,productId:T.product?.id,content:R.trim()},{timeout:1e4,retries:1});t&&e?(O(t=>[...t,e.message]),S("")):console.error("Mesaj g\xf6nderilemedi:",a)}catch(e){console.error("Mesaj g\xf6nderilemedi:",e)}finally{I(!1)}}},Y=e=>{let t=new Date(e),a=Math.floor((new Date().getTime()-t.getTime())/864e5);return 0===a?t.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}):1===a?"D\xfcn":a<7?`${a} g\xfcn \xf6nce`:t.toLocaleDateString("tr-TR")},ee=async e=>{if(J){B(!0);try{(await fetch("/api/messages",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageId:e})})).ok&&(O(t=>t.filter(t=>t.id!==e)),q(null))}catch(e){console.error("Mesaj silinemedi:",e)}finally{B(!1)}}},et=async e=>{if(J){B(!0);try{(await fetch("/api/messages",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationUserId:e.otherUser.id,productId:e.product?.id})})).ok&&(E(t=>t.filter(t=>!(t.otherUser.id===e.otherUser.id&&t.product?.id===e.product?.id))),q(null),T?.otherUser.id===e.otherUser.id&&C(null))}catch(e){console.error("Konuşma silinemedi:",e)}finally{B(!1)}}};return"loading"===t||_?r.jsx("div",{className:"min-h-screen pt-16 pb-24 flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[r.jsx(u.Z,{className:"w-8 h-8 animate-spin text-purple-600"}),r.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:N("loadingMessages")})]})}):A?r.jsx("div",{className:"min-h-screen pt-16 pb-24 flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4 p-6 text-center",children:[r.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:r.jsx(m.Z,{className:"w-8 h-8 text-red-500"})}),r.jsx("p",{className:"text-red-600 dark:text-red-400",children:A}),r.jsx("button",{onClick:()=>{$(null),F()},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition",children:N("tryAgain")})]})}):(0,r.jsxs)("div",{className:"min-h-screen pt-16 pb-24 bg-gray-50 dark:bg-gray-900",children:[!T&&r.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-6 px-4",children:r.jsx("div",{className:"max-w-4xl mx-auto",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx(m.Z,{className:"w-8 h-8"}),(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:N("myMessages")}),(0,r.jsxs)("p",{className:"text-white/80 text-sm",children:[w.length," ",N("conversationCount")]})]})]})})}),r.jsx("div",{className:"max-w-4xl mx-auto",children:r.jsx(o.M,{mode:"wait",children:T?(0,r.jsxs)(c.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex flex-col h-[calc(100vh-8rem)]",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-4 flex items-center gap-3",children:[r.jsx("button",{onClick:()=>C(null),className:"p-2 -ml-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:r.jsx(g.Z,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),r.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center overflow-hidden",children:T.otherUser.image?r.jsx(l.default,{src:T.otherUser.image,alt:T.otherUser.name||"",width:40,height:40,className:"object-cover"}):r.jsx(h.Z,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:(0,b.Gf)(T.otherUser)}),T.product&&(0,r.jsxs)(d.default,{href:`/urun/${T.product.id}`,className:"text-xs text-purple-600 dark:text-purple-400 hover:underline truncate block",children:["\uD83D\uDCE6 ",T.product.title]})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[P?r.jsx("div",{className:"flex justify-center py-8",children:r.jsx(u.Z,{className:"w-6 h-6 animate-spin text-purple-600"})}):U.map(t=>(0,r.jsxs)("div",{className:`flex items-end gap-2 group ${t.senderId===e?.user?.id?"justify-end":"justify-start"}`,children:[t.senderId!==e?.user?.id&&r.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center overflow-hidden flex-shrink-0 mb-1",children:T?.otherUser?.image?r.jsx(l.default,{src:T.otherUser.image,alt:"",width:28,height:28,className:"object-cover w-full h-full"}):r.jsx(h.Z,{className:"w-3.5 h-3.5 text-white"})}),J&&t.senderId===e?.user?.id&&r.jsx("button",{onClick:()=>q({type:"message",id:t.id}),className:"opacity-0 group-hover:opacity-100 p-1 text-red-400 hover:text-red-600 transition-all",title:N("deleteMessage"),children:r.jsx(p.Z,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{className:`max-w-[70%] px-4 py-2 rounded-2xl ${t.senderId===e?.user?.id?"bg-gradient-to-r from-purple-600 to-blue-500 text-white rounded-br-md":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-md"}`,children:[r.jsx("p",{className:"text-sm",children:t.content}),r.jsx("span",{className:`text-xs mt-1 block ${t.senderId===e?.user?.id?"text-white/70":"text-gray-500 dark:text-gray-400"}`,children:Y(t.createdAt)})]}),J&&t.senderId!==e?.user?.id&&r.jsx("button",{onClick:()=>q({type:"message",id:t.id}),className:"opacity-0 group-hover:opacity-100 p-1 text-red-400 hover:text-red-600 transition-all",title:N("deleteMessage"),children:r.jsx(p.Z,{className:"w-4 h-4"})})]},t.id)),r.jsx("div",{ref:K})]}),r.jsx("form",{onSubmit:Q,className:"p-4 bg-white dark:bg-gray-800 border-t dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",value:R,onChange:e=>S(e.target.value),placeholder:N("typeMessage"),className:"flex-1 px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",disabled:D}),r.jsx("button",{type:"submit",disabled:!R.trim()||D,className:"px-4 py-3 bg-gradient-to-r from-purple-600 to-blue-500 text-white rounded-xl font-semibold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:D?r.jsx(u.Z,{className:"w-5 h-5 animate-spin"}):r.jsx(y.Z,{className:"w-5 h-5"})})]})})]},"chat"):r.jsx(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"divide-y divide-gray-100 dark:divide-gray-800",children:0===w.length?(0,r.jsxs)("div",{className:"text-center py-16 px-4",children:[r.jsx(m.Z,{className:"w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2",children:N("noMessages")}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:N("startConversationHint")}),(0,r.jsxs)(d.default,{href:"/urunler",className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-500 text-white rounded-xl font-semibold hover:shadow-lg transition-all",children:[r.jsx(x.Z,{className:"w-5 h-5"}),N("exploreProducts")]})]}):w.map(e=>(0,r.jsxs)("div",{className:"w-full flex items-center gap-4 p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[(0,r.jsxs)("button",{onClick:()=>X(e),className:"flex-1 flex items-center gap-4 text-left",children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center overflow-hidden",children:e.otherUser.image?r.jsx(l.default,{src:e.otherUser.image,alt:e.otherUser.name||"",width:56,height:56,className:"object-cover"}):r.jsx(h.Z,{className:"w-6 h-6 text-white"})}),e.unreadCount>0&&r.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center",children:e.unreadCount})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[r.jsx("span",{className:"font-semibold text-gray-900 dark:text-white truncate",children:(0,b.Gf)(e.otherUser)}),r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 flex-shrink-0",children:Y(e.lastMessage.createdAt)})]}),e.product&&(0,r.jsxs)("p",{className:"text-xs text-purple-600 dark:text-purple-400 truncate",children:["\uD83D\uDCE6 ",e.product.title]}),r.jsx("p",{className:`text-sm truncate ${e.unreadCount>0?"text-gray-900 dark:text-white font-medium":"text-gray-500 dark:text-gray-400"}`,children:e.lastMessage.content})]})]}),J&&r.jsx("button",{onClick:t=>{t.stopPropagation(),q({type:"conversation",conv:e})},className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:N("deleteConversation"),children:r.jsx(p.Z,{className:"w-5 h-5"})})]},`${e.otherUser.id}-${e.product?.id||"general"}`))},"list")})}),r.jsx(o.M,{children:G&&r.jsx(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:()=>q(null),children:(0,r.jsxs)(c.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),className:"bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-sm w-full shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-full",children:r.jsx(f.Z,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),r.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"message"===G.type?N("deleteMessage"):N("deleteConversation")})]}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"message"===G.type?N("deleteMessageConfirm"):`${N("deleteConversationConfirmPrefix")}${G.conv?.otherUser.name}${N("deleteConversationConfirmSuffix")}`}),(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>q(null),disabled:V,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:N("cancel")}),(0,r.jsxs)("button",{onClick:()=>{"message"===G.type&&G.id?ee(G.id):"conversation"===G.type&&G.conv&&et(G.conv)},disabled:V,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[V?r.jsx(u.Z,{className:"w-4 h-4 animate-spin"}):r.jsx(p.Z,{className:"w-4 h-4"}),N("delete")]})]})]})})})]})}},48015:(e,t,a)=>{"use strict";function r(e){if(!e)return"Anonim";if(e.nickname&&e.nickname.trim())return e.nickname.trim();if(e.name&&e.name.trim()){let t=e.name.trim().split(" ").filter(e=>e.length>0);if(1===t.length)return t[0];if(t.length>=2){let e=t[0],a=t[t.length-1].charAt(0).toUpperCase();return`${e} ${a}.`}}if(e.email){let t=e.email.split("@")[0];return t.length>15?t.substring(0,15)+"...":t}return"Anonim"}a.d(t,{Gf:()=>r})},40140:(e,t,a)=>{"use strict";async function r(e){try{await fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e.type,message:e.message,severity:e.severity||"error",userId:e.userId,url:void 0,userAgent:"undefined"!=typeof navigator?navigator.userAgent:void 0,metadata:e.metadata?JSON.stringify(e.metadata):void 0})})}catch{console.error("Error reporter failed:",e.message)}}function s(){return!1}a.d(t,{s9:()=>s,wz:()=>l,DV:()=>d,Pe:()=>o});let i={TIMEOUT:"Sunucu yanıt vermedi. L\xfctfen tekrar deneyin.",SERVER_ERROR:"Sunucu hatası oluştu. L\xfctfen daha sonra tekrar deneyin.",NETWORK_ERROR:"Bağlantı hatası. L\xfctfen internet bağlantınızı kontrol edin.",UNAUTHORIZED:"Oturum s\xfcreniz doldu. L\xfctfen tekrar giriş yapın.",FORBIDDEN:"Bu işlem i\xe7in yetkiniz yok.",NOT_FOUND:"İstenen kaynak bulunamadı.",RATE_LIMITED:"\xc7ok fazla istek g\xf6nderdiniz. L\xfctfen biraz bekleyin.",UNKNOWN:"Beklenmeyen bir hata oluştu."};async function n(e,t,a){let s=new AbortController,n=setTimeout(()=>s.abort(),a);try{let a=await fetch(e,{...t,signal:s.signal,headers:{"Content-Type":"application/json",...t.headers}});clearTimeout(n);let l=null,d=a.headers.get("content-type");if(d?.includes("application/json"))try{l=await a.json()}catch{l=null}if(!a.ok){let t=l?.error||l?.message||function(e,t){switch(e){case 401:return i.UNAUTHORIZED;case 403:return i.FORBIDDEN;case 404:return i.NOT_FOUND;case 429:return i.RATE_LIMITED;case 500:case 502:case 503:case 504:return i.SERVER_ERROR;default:return i.UNKNOWN}}(a.status);return a.status>=500&&r({type:"api_error",message:`API ${a.status}: ${e}`,severity:"error",metadata:{url:e,status:a.status,errorMsg:t}}),{data:null,error:t,status:a.status,ok:!1,isOffline:!1,isTimeout:!1}}return{data:l,error:null,status:a.status,ok:!0,isOffline:!1,isTimeout:!1}}catch(e){if(clearTimeout(n),"AbortError"===e.name)return{data:null,error:i.TIMEOUT,status:0,ok:!1,isOffline:!1,isTimeout:!0};return{data:null,error:i.NETWORK_ERROR,status:0,ok:!1,isOffline:!1,isTimeout:!1}}}async function l(e,t={}){let{timeout:a=1e4,retries:r=2,retryDelay:s=1e3,...i}=t,l=null;for(let t=0;t<=r&&(t>0&&await new Promise(e=>setTimeout(e,s)),!(l=await n(e,i,a)).ok&&401!==l.status&&403!==l.status&&404!==l.status&&429!==l.status);t++);return l}async function d(e,t){return l(e,{...t,method:"GET"})}async function o(e,t,a){return l(e,{...a,method:"POST",body:t?JSON.stringify(t):void 0})}},75909:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});let r=(0,a(71945).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},26482:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});let r=(0,a(71945).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},71028:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});let r=(0,a(71945).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},87189:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(88895).createProxy)(String.raw`/home/ubuntu/takas-a-kodlar/nextjs_space/app/mesajlar/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8412,4674,858],()=>a(30399));module.exports=r})();