"use strict";exports.id=9710,exports.ids=[9710],exports.modules={37481:(e,t,a)=>{a.d(t,{Oy:()=>r,Tn:()=>o,kx:()=>n});var i=a(83178);async function n(){let e=new Date;e.setDate(e.getDate()-7);let t=await i.default.category.findMany({include:{products:{where:{status:"active"},select:{id:!0,views:!0,createdAt:!0}}}}),a=await i.default.swapRequest.findMany({where:{status:"completed",updatedAt:{gte:e}},include:{product:{select:{categoryId:!0}}}}),n={};a.forEach(e=>{let t=e.product.categoryId;n[t]=(n[t]||0)+1});let r=0,o=0;t.forEach(e=>{e.products.forEach(e=>{r+=e.views,o++})});let l=o>0?r/o:0,u=a.length,d=t.map(e=>{let t=e.products.reduce((e,t)=>e+t.views,0),a=e.products.length,i=n[e.id]||0,r=a>0?t/a:0,o=50;l>0&&(o+=(r/l-1)*20),o+=30*(a>0?i/a:0),a<5&&t>2*l&&(o+=15);let u=1;u=(o=Math.max(0,Math.min(100,o)))<50?.8+o/50*.2:1+(o-50)/50*.3;let d="stable";return o>65?d="rising":o<35&&(d="falling"),{categoryId:e.id,categoryName:e.name,totalViews:t,totalProducts:a,completedSwaps:i,avgViewsPerProduct:r,demandScore:Math.round(o),priceMultiplier:Math.round(100*u)/100,trend:d}});return{analyzedAt:new Date,categories:d.sort((e,t)=>t.demandScore-e.demandScore),globalStats:{totalViews:r,totalSwaps:u,avgDemandScore:Math.round(d.reduce((e,t)=>e+t.demandScore,0)/d.length)}}}async function r(e){await i.default.systemMetrics.upsert({where:{id:"demand_analysis"},update:{data:JSON.stringify(e),lastUpdated:new Date},create:{id:"demand_analysis",data:JSON.stringify(e),lastUpdated:new Date}})}async function o(){let e=await i.default.systemMetrics.findUnique({where:{id:"demand_analysis"}});if(!e?.data)return null;try{return JSON.parse(e.data)}catch{return null}}},89710:(e,t,a)=>{a.d(t,{VB:()=>x,Xn:()=>f});var i=a(83178),n=a(37481);let r={goldPerOunce:2650,wheatIndex:220,oliveOilIndex:8500,consumerPriceIndex:100,usdTryRate:35.5,fetchedAt:new Date("2025-01-01")},o={TRY:1,EUR:.026,USD:.028,GBP:.022,fetchedAt:new Date("2026-01-01")};async function l(){try{let e=await i.default.systemMetrics.findUnique({where:{id:"currency_rates"}});if(e?.data){let t=JSON.parse(e.data);if(Date.now()-new Date(t.fetchedAt).getTime()<864e5)return t}}catch{}return o}let u={barcelona:{region:"Barcelona",country:"ES",multiplier:1.1,costOfLivingIndex:110,currency:"EUR",vatRate:.21},madrid:{region:"Madrid",country:"ES",multiplier:1.12,costOfLivingIndex:112,currency:"EUR",vatRate:.21},valencia:{region:"Valencia",country:"ES",multiplier:1,costOfLivingIndex:100,currency:"EUR",vatRate:.21},paris:{region:"Paris",country:"FR",multiplier:1.25,costOfLivingIndex:125,currency:"EUR",vatRate:.2},lyon:{region:"Lyon",country:"FR",multiplier:1.08,costOfLivingIndex:108,currency:"EUR",vatRate:.2},berlin:{region:"Berlin",country:"DE",multiplier:1.1,costOfLivingIndex:110,currency:"EUR",vatRate:.19},munich:{region:"M\xfcnchen",country:"DE",multiplier:1.22,costOfLivingIndex:122,currency:"EUR",vatRate:.19},milan:{region:"Milano",country:"IT",multiplier:1.15,costOfLivingIndex:115,currency:"EUR",vatRate:.22},rome:{region:"Roma",country:"IT",multiplier:1.08,costOfLivingIndex:108,currency:"EUR",vatRate:.22},amsterdam:{region:"Amsterdam",country:"NL",multiplier:1.2,costOfLivingIndex:120,currency:"EUR",vatRate:.21},brussels:{region:"Bruxelles",country:"BE",multiplier:1.12,costOfLivingIndex:112,currency:"EUR",vatRate:.21},lisbon:{region:"Lisboa",country:"PT",multiplier:.95,costOfLivingIndex:95,currency:"EUR",vatRate:.23},london:{region:"London",country:"GB",multiplier:1.3,costOfLivingIndex:130,currency:"GBP",vatRate:.2},manchester:{region:"Manchester",country:"GB",multiplier:1.05,costOfLivingIndex:105,currency:"GBP",vatRate:.2},zurich:{region:"Z\xfcrich",country:"CH",multiplier:1.45,costOfLivingIndex:145,currency:"EUR",vatRate:.077},vienna:{region:"Wien",country:"AT",multiplier:1.12,costOfLivingIndex:112,currency:"EUR",vatRate:.2},athens:{region:"Atina",country:"GR",multiplier:.9,costOfLivingIndex:90,currency:"EUR",vatRate:.24}},d={istanbul:{region:"İstanbul",multiplier:1.15,costOfLivingIndex:115},ankara:{region:"Ankara",multiplier:1.05,costOfLivingIndex:105},izmir:{region:"İzmir",multiplier:1,costOfLivingIndex:100},antalya:{region:"Antalya",multiplier:1.02,costOfLivingIndex:102},bursa:{region:"Bursa",multiplier:.95,costOfLivingIndex:95},adana:{region:"Adana",multiplier:.9,costOfLivingIndex:90},gaziantep:{region:"Gaziantep",multiplier:.88,costOfLivingIndex:88},konya:{region:"Konya",multiplier:.88,costOfLivingIndex:88},trabzon:{region:"Trabzon",multiplier:.85,costOfLivingIndex:85},diyarbakir:{region:"Diyarbakır",multiplier:.82,costOfLivingIndex:82},mersin:{region:"Mersin",multiplier:.9,costOfLivingIndex:90},kayseri:{region:"Kayseri",multiplier:.85,costOfLivingIndex:85},eskisehir:{region:"Eskişehir",multiplier:.92,costOfLivingIndex:92},mugla:{region:"Muğla",multiplier:.98,costOfLivingIndex:98},denizli:{region:"Denizli",multiplier:.88,costOfLivingIndex:88}},c={gold:.3,food:.25,consumer:.25,platform:.2};async function s(){try{let e=await i.default.systemMetrics.findUnique({where:{id:"economic_indices"}});if(e?.data){let t=JSON.parse(e.data);if(Date.now()-new Date(t.fetchedAt).getTime()<864e5)return t}}catch{}return r}async function m(){let e=new Date;e.setDate(e.getDate()-7);let[t,a,n]=await Promise.all([i.default.product.count({where:{status:"active"}}),i.default.swapRequest.count({where:{status:"completed",updatedAt:{gte:e}}}),i.default.swapRequest.findMany({where:{status:"completed"},select:{pendingValorAmount:!0},take:100,orderBy:{updatedAt:"desc"}})]),r=n.length>0?n.reduce((e,t)=>e+(t.pendingValorAmount||0),0)/n.length:200,o=new Date;o.setDate(o.getDate()-30);let l=new Date;l.setDate(l.getDate()-60);let[u,d]=await Promise.all([i.default.swapRequest.aggregate({where:{status:"completed",updatedAt:{gte:o}},_avg:{pendingValorAmount:!0}}),i.default.swapRequest.aggregate({where:{status:"completed",updatedAt:{gte:l,lt:o}},_avg:{pendingValorAmount:!0}})]),c=u._avg.pendingValorAmount||200,s=d._avg.pendingValorAmount||200;return{avgValorPerSwap:Math.round(r),totalActiveProducts:t,swapsLast7Days:a,valorInflationRate:Math.round(100*(s>0?(c-s)/s:0))/100}}async function g(){let e=await s(),t=await m(),a=e.goldPerOunce/r.goldPerOunce,i=(e.wheatIndex/r.wheatIndex+e.oliveOilIndex/r.oliveOilIndex)/2,n=e.consumerPriceIndex/r.consumerPriceIndex,o=e.usdTryRate/r.usdTryRate,l=Math.max(.8,Math.min(1.2,t.totalActiveProducts>0?t.swapsLast7Days/(.1*t.totalActiveProducts):1)),u=a*c.gold+i*c.food+n*c.consumer+l*c.platform,d=function(e,t,a,i,n){let r=[];return e>1.05&&r.push("Altın fiyatları y\xfckseldi, değerli eşyalar daha kıymetli"),t>1.05&&r.push("Gıda endeksi arttı, temel ihtiya\xe7 \xfcr\xfcnleri değerlendi"),a>1.05&&r.push("T\xfcketici fiyatları y\xfckseldi"),i>1.1&&r.push("Platformda y\xfcksek takas aktivitesi var"),i<.9&&r.push("Platformda takas aktivitesi d\xfcş\xfck"),n>.05&&r.push("Valor enflasyonu tespit edildi, fiyatlar dengeleniyor"),r.length>0?r.join(". ")+".":"Piyasa koşulları stabil."}(a,i,n,l,t.valorInflationRate);return{rate:Math.round(1/(u*o)*100)/100,compositeIndex:Math.round(100*u)/100,goldFactor:Math.round(100*a)/100,foodFactor:Math.round(100*i)/100,consumerFactor:Math.round(100*n)/100,platformFactor:Math.round(100*l)/100,calculatedAt:new Date,explanation:d}}async function f(e,t){let a=await l(),i=await g(),r=t?.toLowerCase().trim()||"",o=null,c="TR",s="TRY";for(let[e,t]of Object.entries(d))if(r.includes(e)){o=t,c="TR",s="TRY";break}if(!o){for(let[e,t]of Object.entries(u))if(r.includes(e)){o=t,c=t.country,s=t.currency;break}}o||(o=d.izmir||{region:t||"Bilinmeyen",multiplier:1,costOfLivingIndex:100});let m=Math.round(Math.round(e/i.rate)*o.multiplier),f={TRY:m,EUR:Math.round(m*a.EUR*100)/100,USD:Math.round(m*a.USD*100)/100,GBP:Math.round(m*a.GBP*100)/100},y=f[s]||f.TRY,p=(await (0,n.kx)()).globalStats.avgDemandScore,x=p>65?"\uD83D\uDD25 Y\xfcksek":p<35?"❄️ D\xfcş\xfck":"⚖️ Normal",v=`Bu \xfcr\xfcn ${o.region} b\xf6lgesinde yaklaşık ${y} ${{TRY:"₺",EUR:"€",USD:"$",GBP:"\xa3"}[s]} değerinde. Yaşam maliyeti endeksi: ${o.costOfLivingIndex}. Talep: ${x}.`;return{valorPrice:e,city:o.region||t,country:c,localPrices:f,primaryCurrency:s,primaryPrice:y,regionalMultiplier:o.multiplier,costOfLivingIndex:o.costOfLivingIndex,demandLevel:x,explanation:v}}async function y(){let e=await m();return e.valorInflationRate>.05?Math.max(.9,1-(e.valorInflationRate-.05)):e.valorInflationRate<-.05?Math.min(1.1,1+Math.abs(e.valorInflationRate+.05)):1}let p={Elektronik:{min:500,max:5e4},Telefon:{min:1e3,max:4e4},Bilgisayar:{min:2e3,max:6e4},Giyim:{min:50,max:3e3},Ayakkabı:{min:100,max:5e3},"Ev Eşyası":{min:100,max:2e4},"Beyaz Eşya":{min:2e3,max:3e4},Mobilya:{min:500,max:25e3},Mutfak:{min:50,max:5e3},Kitap:{min:20,max:500},Spor:{min:100,max:1e4},Bebek:{min:50,max:5e3},Oyuncak:{min:30,max:2e3},Hobi:{min:50,max:5e3},Müzik:{min:200,max:15e3},Bahçe:{min:50,max:3e3},"Evcil Hayvan":{min:30,max:2e3},Oto:{min:100,max:1e4},Aksesuar:{min:30,max:3e3},Saat:{min:100,max:2e4},default:{min:50,max:5e3}};async function x(e,t,a,i){let r=await g(),o={new:1,likeNew:.85,good:.7,fair:.5,poor:.3}[a]||.7,l=(await (0,n.kx)()).categories.find(e=>e.categoryName.toLowerCase().includes(t.toLowerCase())),c=l?.priceMultiplier||1,s=function(e){let t=e?.toLowerCase().trim()||"";for(let[e,a]of Object.entries(d))if(t.includes(e))return{...a,currency:"TRY"};for(let[e,a]of Object.entries(u))if(t.includes(e))return{region:a.region,multiplier:a.multiplier,costOfLivingIndex:a.costOfLivingIndex,currency:a.currency};return{region:"Genel",multiplier:1,costOfLivingIndex:100,currency:"TRY"}}(i||""),m=await y(),f=e*r.rate,x=Math.round(f*o*c*s.multiplier*m),v=p[t]||p.default,h=Math.round(v.min*r.rate*.3),w=Math.max(10,Math.min(Math.round(v.max*r.rate*1.3),Math.max(h,x))),R=`Bu \xfcr\xfcn\xfcn tahmini piyasa değeri ~${e}₺. \xdcr\xfcn durumu ${o>=.85?"\xe7ok iyi":o>=.7?"iyi":o>=.5?"orta":"d\xfcş\xfck"}. Kategoride ${c>1.1?"y\xfcksek talep (+%"+Math.round((c-1)*100)+")":c<.9?"d\xfcş\xfck talep (-%"+Math.round((1-c)*100)+")":"normal talep"}. ${s.region} b\xf6lgesinde yaşam maliyeti endeksi: ${s.costOfLivingIndex}. Sonu\xe7: ${w} Valor.`,I=`${e}₺ \xd7 ${r.rate} kur \xd7 ${o} durum \xd7 ${c.toFixed(2)} talep \xd7 ${s.multiplier} b\xf6lge \xd7 ${m} enflasyon = ${w} Valor`;return{valorPrice:w,breakdown:{baseValueTL:e,valorRate:r.rate,rawValor:Math.round(f),conditionMultiplier:o,demandMultiplier:c,regionalMultiplier:s.multiplier,inflationCorrection:m,finalValor:w},marketContext:{goldTrend:r.goldFactor>1.02?"\uD83D\uDCC8 Y\xfckseliyor":r.goldFactor<.98?"\uD83D\uDCC9 D\xfcş\xfcyor":"➡️ Stabil",foodTrend:r.foodFactor>1.05?"\uD83D\uDCC8 Y\xfckseliyor":"➡️ Stabil",demandLevel:(l?.demandScore||50)>65?"\uD83D\uDD25 Y\xfcksek talep":35>(l?.demandScore||50)?"❄️ D\xfcş\xfck talep":"⚖️ Normal",inflationStatus:m<.95?"⚠️ Valor enflasyonu (d\xfczeltme uygulandı)":m>1.05?"\uD83D\uDCC9 Valor deflasyonu (destek uygulandı)":"✅ Stabil",region:s.region},humanExplanation:R,formula:I,confidence:e>0?"high":"medium"}}}};