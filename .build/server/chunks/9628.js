"use strict";exports.id=9628,exports.ids=[9628],exports.modules={59628:(i,a,e)=>{e.d(a,{LX:()=>p,Y0:()=>u,j_:()=>d,kd:()=>E});var n=e(87853),t=e.n(n),s=e(83178);let o="BOlBaaC047bCq8RXHRkz7Eg3pp66EiiH5GgjYncOeWPhVwtPtE-fCMeguexDcpp3sdNC8XBdMP0CKyexg8kOA4w",l=process.env.VAPID_PRIVATE_KEY||"",r=process.env.NEXTAUTH_URL||"https://takas-a.com";o&&l&&t().setVapidDetails(r,o,l);let d={NEW_MESSAGE:"new_message",SWAP_REQUEST:"swap_request",SWAP_ACCEPTED:"swap_accepted",SWAP_REJECTED:"swap_rejected",SWAP_DELIVERY_SETUP:"swap_delivery_setup",SWAP_QR_SCANNED:"swap_qr_scanned",SWAP_CONFIRMED:"swap_confirmed",SWAP_COMPLETED:"swap_completed",SWAP_DISPUTE:"swap_dispute",SWAP_REFUNDED:"swap_refunded",SWAP_CANCELLED:"swap_cancelled",MULTI_SWAP:"multi_swap",MULTI_SWAP_INVITE:"multi_swap_invite",MULTI_SWAP_CONFIRMED:"multi_swap_confirmed",MULTI_SWAP_PROGRESS:"multi_swap_progress",MULTI_SWAP_REJECTED:"multi_swap_rejected",VALOR_RECEIVED:"valor_received",PRODUCT_INTEREST:"product_interest",SYSTEM:"system",SWAP_REMINDER_24H:"swap_reminder_24h",SWAP_REMINDER_8H:"swap_reminder_8h",SWAP_REMINDER_2H:"swap_reminder_2h",MULTI_SWAP_REMINDER_24H:"multi_swap_reminder_24h",MULTI_SWAP_REMINDER_8H:"multi_swap_reminder_8h",MULTI_SWAP_REMINDER_2H:"multi_swap_reminder_2h",DELIVERY_REMINDER_48H:"delivery_reminder_48h",DELIVERY_REMINDER_24H:"delivery_reminder_24h",DELIVERY_REMINDER_6H:"delivery_reminder_6h",DISPUTE_EVIDENCE_REQUEST:"dispute_evidence_request",DISPUTE_EVIDENCE_SUBMITTED:"dispute_evidence_submitted",DISPUTE_SETTLEMENT_OFFER:"dispute_settlement_offer",DISPUTE_SETTLEMENT_ACCEPTED:"dispute_settlement_accepted",DISPUTE_DEADLINE_WARNING:"dispute_deadline_warning"},c={[d.NEW_MESSAGE]:i=>({title:"Yeni Mesaj \uD83D\uDCAC",body:`${i.senderName}: ${i.preview}`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=messages",tag:`message-${i.conversationId}`}),[d.SWAP_REQUEST]:i=>({title:"Yeni Takas Teklifi \uD83D\uDD04",body:`${i.requesterName} "${i.productTitle}" i\xe7in takas teklifi g\xf6nderdi`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=offers",tag:`swap-${i.swapId}`}),[d.SWAP_ACCEPTED]:i=>({title:"Takas Kabul Edildi ✅",body:`"${i.productTitle}" i\xe7in takas teklifiniz kabul edildi!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`swap-accepted-${i.swapId}`}),[d.SWAP_REJECTED]:i=>({title:"Takas Teklifi Reddedildi ❌",body:`"${i.productTitle}" i\xe7in takas teklifiniz reddedildi. Teminatınız iade edildi.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=offers",tag:`swap-rejected-${i.swapId}`}),[d.SWAP_DELIVERY_SETUP]:i=>({title:"Teslimat Ayarlandı \uD83D\uDCE6",body:`"${i.productTitle}" i\xe7in teslimat ayarlandı. QR kodunu kullanarak \xfcr\xfcn\xfc teslim alabilirsiniz.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`swap-delivery-${i.swapId}`}),[d.SWAP_QR_SCANNED]:i=>({title:"QR Kod Tarandı \uD83D\uDCF1",body:`"${i.productTitle}" i\xe7in QR kod tarandı. \xdcr\xfcn teslim alındı olarak işaretlendi.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`swap-qr-${i.swapId}`}),[d.SWAP_CONFIRMED]:i=>({title:"Teslimat Onaylandı ✅",body:`"${i.productTitle}" teslimatı ${i.confirmerName} tarafından onaylandı.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`swap-confirmed-${i.swapId}`}),[d.SWAP_COMPLETED]:i=>({title:"Takas Tamamlandı \uD83C\uDF89",body:`Tebrikler! "${i.productTitle}" takası başarıyla tamamlandı.${i.valorAmount?` +${i.valorAmount} Valor kazandınız!`:""}`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`swap-complete-${i.swapId}`}),[d.SWAP_DISPUTE]:i=>({title:"Sorun Bildirildi ⚠️",body:`"${i.productTitle}" takası i\xe7in ${i.reporterName} sorun bildirdi: ${i.reason}`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`swap-dispute-${i.swapId}`}),[d.SWAP_REFUNDED]:i=>({title:"Teminat İade Edildi \uD83D\uDCB0",body:`"${i.productTitle}" takası iptal edildi. Teminatınız hesabınıza iade edildi.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil",tag:`swap-refunded-${i.swapId}`}),[d.SWAP_CANCELLED]:i=>({title:"Takas İptal Edildi ❌",body:`"${i.productTitle}" takası iptal edildi. ${i.reason||""}`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/takaslarim",tag:`swap-cancelled-${i.swapId}`}),[d.MULTI_SWAP]:i=>({title:"\xc7oklu Takas Fırsatı! \uD83D\uDD25",body:`${i.participantCount} kişilik bir takas zinciri sizi bekliyor!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/takas-firsatlari",tag:`multi-swap-${i.multiSwapId}`}),[d.MULTI_SWAP_INVITE]:i=>({title:"\uD83D\uDD04 \xc7oklu Takas Daveti!",body:`${i.initiatorName} sizi ${i.participantCount} kişilik bir takas zincirine davet etti. 48 saat i\xe7inde yanıt verin!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/takas-firsatlari",tag:`multi-swap-invite-${i.multiSwapId}`}),[d.MULTI_SWAP_CONFIRMED]:i=>({title:"✅ \xc7oklu Takas Onaylandı!",body:`${i.participantCount} kişilik takas herkes tarafından onaylandı! Teslim detayları i\xe7in uygulamayı kontrol edin.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/takas-firsatlari",tag:`multi-swap-confirmed-${i.multiSwapId}`}),[d.MULTI_SWAP_PROGRESS]:i=>({title:"\uD83D\uDC4D Takas Onayı Alındı",body:`${i.confirmerName} takası onayladı. ${i.remainingCount} kişi daha bekleniyor.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/takas-firsatlari",tag:`multi-swap-progress-${i.multiSwapId}`}),[d.MULTI_SWAP_REJECTED]:i=>({title:"❌ \xc7oklu Takas İptal Edildi",body:`${i.rejecterName} \xe7oklu takas teklifini reddetti.${i.reason?` Sebep: ${i.reason}`:""}`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/takas-firsatlari",tag:`multi-swap-rejected-${i.multiSwapId}`}),[d.VALOR_RECEIVED]:i=>({title:"Valor Kazandınız! \uD83D\uDC8E",body:`+${i.amount} Valor hesabınıza eklendi. ${i.reason}`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil",tag:`valor-${Date.now()}`}),[d.PRODUCT_INTEREST]:i=>({title:"\xdcr\xfcn\xfcn\xfcz İlgi G\xf6r\xfcyor! \uD83D\uDC40",body:`"${i.productTitle}" \xfcr\xfcn\xfcn\xfcz ${i.viewCount} kez g\xf6r\xfcnt\xfclendi`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:`/urun/${i.productId}`,tag:`interest-${i.productId}`}),[d.SYSTEM]:i=>({title:i.title||"TAKAS-A",body:i.body,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:i.url||"/",tag:`system-${Date.now()}`}),[d.SWAP_REMINDER_24H]:i=>({title:"⏰ Takas Hatırlatması - 24 Saat Kaldı",body:`"${i.productTitle}" i\xe7in takas teklifinize ${i.hoursLeft} saat i\xe7inde yanıt verin!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=offers",tag:`swap-reminder-24h-${i.swapId}`}),[d.SWAP_REMINDER_8H]:i=>({title:"⚠️ Acil: Sadece 8 Saat Kaldı!",body:`"${i.productTitle}" takas teklifine yanıt vermeyi unutmayın. Aksi halde otomatik iptal olacak!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=offers",tag:`swap-reminder-8h-${i.swapId}`}),[d.SWAP_REMINDER_2H]:i=>({title:"\uD83D\uDEA8 Son 2 Saat! Kararınızı Verin",body:`"${i.productTitle}" takas teklifi 2 saat i\xe7inde sona erecek! Hemen değerlendirin.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=offers",tag:`swap-reminder-2h-${i.swapId}`}),[d.MULTI_SWAP_REMINDER_24H]:i=>({title:"⏰ \xc7oklu Takas - 24 Saat Kaldı",body:`${i.participantCount} kişilik takas zincirine katılım i\xe7in ${i.hoursLeft} saat kaldı!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/takas-firsatlari",tag:`multi-swap-reminder-24h-${i.multiSwapId}`}),[d.MULTI_SWAP_REMINDER_8H]:i=>({title:"⚠️ \xc7oklu Takas - 8 Saat Kaldı!",body:`Takas zinciri onayınızı bekleniyor. Onaylamazsanız ${i.participantCount} kişilik zincir iptal olacak!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/takas-firsatlari",tag:`multi-swap-reminder-8h-${i.multiSwapId}`}),[d.MULTI_SWAP_REMINDER_2H]:i=>({title:"\uD83D\uDEA8 Son 2 Saat! Takas Zinciri Bekleniyor",body:`Onayınız olmadan ${i.participantCount} kişilik takas zinciri iptal olacak. Hemen onaylayın!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/takas-firsatlari",tag:`multi-swap-reminder-2h-${i.multiSwapId}`}),[d.DELIVERY_REMINDER_48H]:i=>({title:"\uD83D\uDCE6 Teslimat Hatırlatması",body:`"${i.productTitle}" i\xe7in teslimat ${i.hoursLeft} saat i\xe7inde yapılmalı. QR kodunuz hazır!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`delivery-reminder-48h-${i.swapId}`}),[d.DELIVERY_REMINDER_24H]:i=>({title:"⚠️ Teslimat İ\xe7in 24 Saat!",body:`"${i.productTitle}" teslimatı yarın sona eriyor. Teslimat noktasında buluşmayı unutmayın!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`delivery-reminder-24h-${i.swapId}`}),[d.DELIVERY_REMINDER_6H]:i=>({title:"\uD83D\uDEA8 Son 6 Saat! Teslimat Acil",body:`"${i.productTitle}" teslimatı 6 saat i\xe7inde yapılmazsa takas iptal edilecek!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`delivery-reminder-6h-${i.swapId}`}),[d.DISPUTE_EVIDENCE_REQUEST]:i=>({title:"\uD83D\uDCF8 Kanıt Y\xfckleme Gerekli",body:`"${i.productTitle}" i\xe7in a\xe7ılan sorun kaydına 48 saat i\xe7inde kanıt y\xfckleyin.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`dispute-evidence-${i.disputeId}`}),[d.DISPUTE_EVIDENCE_SUBMITTED]:i=>({title:"✅ Kanıt Y\xfcklendi",body:`${i.submitterName} sorun kaydına kanıt y\xfckledi. İnceleme başladı.`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`dispute-evidence-submitted-${i.disputeId}`}),[d.DISPUTE_SETTLEMENT_OFFER]:i=>({title:"\uD83E\uDD1D Uzlaşma Teklifi",body:`"${i.productTitle}" i\xe7in uzlaşma teklifi: ${i.offerDescription}`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`dispute-settlement-${i.disputeId}`}),[d.DISPUTE_SETTLEMENT_ACCEPTED]:i=>({title:"✅ Uzlaşma Kabul Edildi",body:`"${i.productTitle}" i\xe7in uzlaşma sağlandı. ${i.resolution}`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`dispute-settlement-accepted-${i.disputeId}`}),[d.DISPUTE_DEADLINE_WARNING]:i=>({title:"⚠️ Kanıt S\xfcresi Doluyor",body:`"${i.productTitle}" i\xe7in kanıt y\xfckleme s\xfcreniz ${i.hoursLeft} saat i\xe7inde dolacak!`,icon:"/icons/icon-192x192.png",badge:"/icons/icon-96x96.png",url:"/profil?tab=swaps",tag:`dispute-deadline-${i.disputeId}`})};async function p(i,a,e){try{let n=await s.default.pushSubscription.findMany({where:{userId:i,isActive:!0}});if(0===n.length)return{success:!0,sent:0,failed:0};let o=c[a];if(!o)return console.error(`Unknown notification type: ${a}`),{success:!1,sent:0,failed:0};let l={...o(e),type:{[d.NEW_MESSAGE]:"new_message",[d.SWAP_REQUEST]:"swap_request",[d.SWAP_ACCEPTED]:"swap_accepted",[d.SWAP_REJECTED]:"swap_rejected",[d.SWAP_COMPLETED]:"swap_completed",[d.SWAP_CANCELLED]:"swap_cancelled",[d.VALOR_RECEIVED]:"valor_received",[d.PRODUCT_INTEREST]:"product_interest",[d.MULTI_SWAP]:"multi_swap",[d.MULTI_SWAP_INVITE]:"multi_swap_invite",[d.SYSTEM]:"system"}[a]||"general",data:{...e,notificationType:a,timestamp:Date.now()}},r=JSON.stringify(l),p=0,u=0,E={TTL:60,urgency:"high",topic:a},_=n.map(async i=>{try{return await t().sendNotification({endpoint:i.endpoint,keys:{p256dh:i.p256dh,auth:i.auth}},r,E),{success:!0,subId:i.id}}catch(a){return(404===a.statusCode||410===a.statusCode)&&await s.default.pushSubscription.update({where:{id:i.id},data:{isActive:!1}}),console.error(`Push notification failed for ${i.id}:`,a.message),{success:!1,subId:i.id}}});for(let i of(await Promise.allSettled(_)))"fulfilled"===i.status&&i.value.success?p++:u++;return{success:!0,sent:p,failed:u}}catch(i){return console.error("sendPushToUser error:",i),{success:!1,sent:0,failed:0}}}async function u(i,a,e){let n=0,t=0;for(let s of i){let i=await p(s,a,e);n+=i.sent,t+=i.failed}return{success:!0,totalSent:n,totalFailed:t}}async function E(i,a){try{let e=await s.default.pushSubscription.findMany({where:{isActive:!0},select:{userId:!0}}),n=[...new Set(e.map(i=>i.userId))];return u(n,i,a)}catch(i){return console.error("sendPushBroadcast error:",i),{success:!1,totalSent:0,totalFailed:0}}}}};